(function(g){var window=this;'use strict';var Bkb=function(a){var b=new g.IH("und",new g.EK("Default","und",!0));b.captionTracks=a.captionTracks;return b},Ckb=function(a){return new g.Af(function(b,c){var d=a.length,e=[];
if(d)for(var f=function(n,p){d--;e[n]=p;0==d&&b(e)},h=function(n){c(n)},l=0,m;l<a.length;l++)m=a[l],g.Cca(m,g.Na(f,l),h);
else b(e)})},U6=function(a){this.j=a},V6=function(){U6.apply(this,arguments)},Dkb=function(){V6.apply(this,arguments)},Ekb=function(){V6.apply(this,arguments)},Fkb=function(){V6.apply(this,arguments)},Gkb=function(){U6.apply(this,arguments)},Hkb=function(){V6.apply(this,arguments)},Ikb=function(){V6.apply(this,arguments)},Jkb=function(){V6.apply(this,arguments)},Kkb=function(){V6.apply(this,arguments)},Lkb=function(){V6.apply(this,arguments)},Mkb=function(){V6.apply(this,arguments)},Nkb=function(){V6.apply(this,
arguments)},Okb=function(){V6.apply(this,arguments)},Pkb=function(){V6.apply(this,arguments)},Qkb=function(){V6.apply(this,arguments)},Rkb=function(){U6.apply(this,arguments)},Skb=function(){V6.apply(this,arguments)},Tkb=function(){V6.apply(this,arguments)},Ukb=function(){V6.apply(this,arguments)},Vkb=function(){V6.apply(this,arguments)},Wkb=function(){V6.apply(this,arguments)},Xkb=function(){V6.apply(this,arguments)},Ykb=function(){V6.apply(this,arguments)},Zkb=function(){V6.apply(this,arguments)},
$kb=function(){V6.apply(this,arguments)},alb=function(){U6.apply(this,arguments)},blb=function(){U6.apply(this,arguments)},clb=function(){U6.apply(this,arguments)},dlb=function(){V6.apply(this,arguments)},elb=function(){V6.apply(this,arguments)},flb=function(){V6.apply(this,arguments)},glb=function(){V6.apply(this,arguments)},hlb=function(){V6.apply(this,arguments)},ilb=function(){V6.apply(this,arguments)},jlb=function(){V6.apply(this,arguments)},klb=function(){V6.apply(this,arguments)},llb=function(){V6.apply(this,
arguments)},mlb=function(){V6.apply(this,arguments)},nlb=function(){V6.apply(this,arguments)},olb=function(){V6.apply(this,arguments)},plb=function(){V6.apply(this,arguments)},qlb=function(){V6.apply(this,arguments)},rlb=function(){V6.apply(this,arguments)},slb=function(){V6.apply(this,arguments)},tlb=function(){V6.apply(this,arguments)},ulb=function(){V6.apply(this,arguments)},vlb=function(){V6.apply(this,arguments)},wlb=function(){V6.apply(this,arguments)},xlb=function(){V6.apply(this,arguments)},
ylb=function(){U6.apply(this,arguments)},zlb=function(){V6.apply(this,arguments)},Alb=function(){V6.apply(this,arguments)},Blb=function(){V6.apply(this,arguments)},Clb=function(){V6.apply(this,arguments)},Dlb=function(){V6.apply(this,arguments)},Elb=function(){V6.apply(this,arguments)},Flb=function(){V6.apply(this,arguments)},Glb=function(){V6.apply(this,arguments)},Hlb=function(){V6.apply(this,arguments)},Ilb=function(){V6.apply(this,arguments)},Jlb=function(){V6.apply(this,arguments)},Klb=function(){V6.apply(this,
arguments)},Llb=function(){V6.apply(this,arguments)},Mlb=function(){V6.apply(this,arguments)},Nlb=function(){V6.apply(this,arguments)},Olb=function(){V6.apply(this,arguments)},Plb=function(){V6.apply(this,arguments)},Qlb=function(){V6.apply(this,arguments)},Rlb=function(){V6.apply(this,arguments)},Slb=function(){V6.apply(this,arguments)},Tlb=function(){V6.apply(this,arguments)},Ulb=function(a){return g.oC((0,g.seb)(),a)},W6=function(a){this.token=a},Vlb=function(a){a=a.key||a.id;
if(!a)throw Error("Entity key is missing");return a},Wlb=function(){if(X6)return X6();
var a={};X6=g.HC("PersistentEntityStoreDb",{lr:(a.EntityStore={Rm:1},a.EntityAssociationStore={Rm:2},a),shared:!1,upgrade:function(b,c){c(1)&&g.iC(g.cC(b,"EntityStore",{keyPath:"key"}),"entityType","entityType");c(2)&&(b=g.cC(b,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.iC(b,"byParentEntityKey","parentEntityKey"),g.iC(b,"byChildEntityKey","childEntityKey"))},
version:3});return X6()},Xlb=function(a){return g.oC(Wlb(),a)},Y6=function(a,b){b=void 0===b?{}:b;
g.sB.call(this,g.Ceb[a],Object.assign({},{name:"PESEncoderError",type:a},b));this.type=a;this.level="WARNING";Object.setPrototypeOf(this,Y6.prototype)},Ylb=function(a){return new Y6("WRONG_DATA_TYPE",{s4:a})},Zlb=function(a){return a instanceof Error?new Y6("UNKNOWN_ENCODE_ERROR",{uP:a.message}):new Y6("UNKNOWN_ENCODE_ERROR")},$lb=function(a){return a instanceof Error?new Y6("UNKNOWN_DECODE_ERROR",{uP:a.message}):new Y6("UNKNOWN_DECODE_ERROR")},amb=function(a,b){a=a instanceof Y6?a:b(a);
g.gG(a);throw a;},bmb=function(){},cmb=function(a,b,c){try{return a.B(b,c)}catch(d){amb(d,Zlb)}},dmb=function(a){a=(new TextEncoder).encode(a).subarray(0,16);
var b=new Uint8Array(16);b.set(a);return b},Z6=function(a){this.j=a},fmb=function(a){var b=emb[a];
if(b)return b;g.hG(new g.sB("Entity model not found.",{entityType:a}))},gmb=function(a,b){this.j=a;
this.u=b;this.B={}},imb=function(a,b){a:{a=hmb(a.u,b.version);
try{var c=a.u(b.data,b.key);break a}catch(d){amb(d,$lb)}c=void 0}return c},$6=function(a,b,c){return a.j.objectStore("EntityStore").get(b).then(function(d){if(d){if(c&&d.entityType!==c)throw Error("Incorrect entity type");
return imb(a,d)}})},a7=function(a,b,c){return c?(c=c.map(function(d){return $6(a,d,b)}),g.WB.all(c)):a.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(b)).then(function(d){return d.map(function(e){return imb(a,e)})})},c7=function(a,b,c){var d=Vlb(b),e=hmb(a.u,1),f=Object.assign({},b);
return a.j.objectStore("EntityStore").get(d).then(function(h){if(h){if(h.entityType!==c)throw Error("Incorrect entity type");f.entityMetadata||(h=imb(a,h),f.entityMetadata=h.entityMetadata)}}).then(function(){var h={key:d,
entityType:c,data:cmb(e,f,d),version:1};return g.WB.all([g.fC(a.j.objectStore("EntityStore"),h),jmb(a,f,c)])}).then(function(){b7(a,d,c);
return d})},kmb=function(a,b,c){b=b.map(function(d){return c7(a,d,c)});
return g.WB.all(b)},d7=function(a,b,c){if(null==c?0:c.Gs){var d=new Set;
return lmb(a,b,d).then(function(){for(var f=[],h=g.u(d),l=h.next();!l.done;l=h.next())f.push(d7(a,l.value));return g.WB.all(f).then(function(){})})}var e=g.KN(b).entityType;
return g.WB.all([a.j.objectStore("EntityStore").delete(b),mmb(a,b)]).then(function(){b7(a,b,e)})},nmb=function(a,b){return g.lC(a.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(b)},function(c){return g.WB.all([c.delete(),
mmb(a,c.bH())]).then(function(){b7(a,c.bH(),b);return c.continue()})})},omb=function(a,b,c,d){var e=hmb(a.u,1);
return $6(a,b,d).then(function(f){if(f){f=g.Dxa(f,c);var h={key:b,entityType:d,data:cmb(e,f,b),version:1};return g.WB.all([g.fC(a.j.objectStore("EntityStore"),h),jmb(a,f,d)])}}).then(function(){b7(a,b,d);
return b})},b7=function(a,b,c){var d=a.B[c];
d||(d=new Set,a.B[c]=d);d.add(b)},pmb=function(a,b,c){var d=Vlb(b);
c=fmb(c);if(!c)return g.WB.resolve([]);c=new c(b);a=a.j.objectStore("EntityAssociationStore");b=[];c=g.u(c.u());for(var e=c.next();!e.done;e=c.next())b.push(g.fC(a,{parentEntityKey:d,childEntityKey:e.value}));return g.WB.all(b).then(function(f){return f.map(function(h){return h[1]})})},mmb=function(a,b){return a.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b))},jmb=function(a,b,c){var d=Vlb(b);
return mmb(a,d).then(function(){return pmb(a,b,c)})},lmb=function(a,b,c){if(c.has(b))return g.WB.resolve(void 0);
c.add(b);return qmb(a,b).then(function(d){return a.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b)).then(function(){return d})}).then(function(d){var e=g.WB.resolve(void 0);
d=g.u(d);for(var f=d.next(),h={};!f.done;h={SJ:h.SJ},f=d.next())h.SJ=f.value,e=e.then(function(l){return function(){return lmb(a,l.SJ,c)}}(h));
return e}).then(function(){})},qmb=function(a,b){var c=a.j.objectStore("EntityAssociationStore");
return c.index("byParentEntityKey").getAll(IDBKeyRange.only(b)).then(function(d){var e=[];d=g.u(d);for(var f=d.next();!f.done;f=d.next())f=f.value,e.push(c.index("byChildEntityKey").getAll(f.childEntityKey));return g.WB.all(e)}).then(function(d){var e=[];
d=g.u(d);for(var f=d.next();!f.done;f=d.next())f=f.value,1===f.length&&e.push(f[0].childEntityKey);return e})},e7=function(){},rmb=function(){this.j={};
this.j[0]=new e7;if(!g.vz("aes_pes_encoder_killswitch")){var a=this.j;try{var b=g.tB();var c=dmb(b);var d=new Z6(new g.dM(c),new g.cM(c))}catch(e){throw a=e instanceof Error?new Y6("KEY_CREATION_FAILED",{uP:e.message}):new Y6("KEY_CREATION_FAILED"),g.gG(a),a;}a[1]=d}},hmb=function(a,b){b=void 0===b?0:b;
a=a.j[b];if(!a)throw b=new Y6("INVALID_ENCODER_VERSION",{s4:b}),g.gG(b),b;return a},f7=function(a,b){g.y.call(this);
this.token=a;this.j=b;this.observers=[];a=new g.va.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.tB());a.onmessage=this.u.bind(this);this.channel=a},g7=async function(a,b,c){var d;
b=await g.eC(await Xlb(a.token),["EntityStore","EntityAssociationStore"],b,function(f){d=new gmb(f,a.j);return c(d)});
if(d){var e=d.B;0<Object.keys(e).length&&(a.channel.postMessage(e),smb(a,e))}return b},tmb=function(a,b){a.observers.push(b);
return function(){var c=a.observers.indexOf(b);0<=c&&a.observers.splice(c,1)}},h7=function(a,b,c){return g7(a,{mode:"readwrite",
hc:!0},function(d){return c7(d,b,c)})},umb=function(a,b){return g7(a,{mode:"readwrite",
hc:!0},function(c){return kmb(c,b,"offlineOrchestrationActionWrapperEntity")})},vmb=function(a,b){return g7(a,{mode:"readwrite",
hc:!0},function(c){return d7(c,b)})},i7=function(a,b,c){return g7(a,{mode:"readonly",
hc:!0},function(d){return $6(d,b,c)})},j7=function(a,b,c){return g7(a,{mode:"readonly",
hc:!0},function(d){return a7(d,b,c)})},smb=function(a,b){a=g.u(a.observers);
for(var c=a.next();!c.done;c=a.next())c=c.value,c(b)},wmb=async function(){try{var a=await g.FC();
if(a&&g.uB()&&"undefined"!==typeof g.va.BroadcastChannel){var b=new rmb;return new f7(a,b)}}catch(c){c instanceof Error&&g.gG(c)}},k7=function(){xmb||(xmb=wmb());
return xmb},ymb=function(a){var b;
a=null==(b=a.options)?void 0:b.persistenceOption;return"ENTITY_PERSISTENCE_OPTION_PERSIST"===a||"ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"===a},zmb=async function(a){var b=await k7();
b&&await g7(b,"readwrite",function(c){for(var d={},e=g.u(a),f=e.next(),h={};!f.done;h={dj:h.dj,jx:h.jx},f=e.next())h.dj=f.value,h.dj.entityKey&&ymb(h.dj)&&(h.jx=g.Hc(h.dj.payload),f=void 0,"ENTITY_MUTATION_TYPE_REPLACE"===h.dj.type&&(f=function(l){return function(){return c7(c,l.dj.payload[l.jx],l.jx)}}(h)),"ENTITY_MUTATION_TYPE_DELETE"===h.dj.type&&(f=function(l){return function(){return d7(c,l.dj.entityKey)}}(h)),"ENTITY_MUTATION_TYPE_UPDATE"===h.dj.type&&(f=function(l){return function(){return omb(c,
l.dj.entityKey,l.dj.payload[l.jx],l.jx)}}(h)),f&&(d[h.dj.entityKey]=d[h.dj.entityKey]?d[h.dj.entityKey].then(f):f()));
return g.WB.all(Object.values(d))})},Amb=async function(a){if((a=a.mutations)&&!(0>=a.length)){if(g.vO){var b={type:"ENTITY_LOADED"};
void 0!==a&&(b.payload=a);g.vO.dispatch(b)}await zmb(a);a.length=0}},Bmb=function(a){return void 0!==a},Cmb=function(a){var b=g.TN();
b=Object.assign({},b);a=Object.assign({},a);for(var c in b)a[c]?(4!==b[c]&&(b[c]=a[c]),delete a[c]):2!==b[c]&&(b[c]=4);Object.assign(b,a);g.Wxa(b);JSON.stringify(b);return b},Dmb=async function(a){var b=await g.FC();
if(b)return g.eC(await g.WN(b),["index","media","captions"],{mode:"readwrite",hc:!0},function(c){var d=IDBKeyRange.bound(a+"|",a+"~");c=[c.objectStore("index").delete(d),c.objectStore("media").delete(d),c.objectStore("captions").delete(d)];return g.WB.all(c).then(function(){})})},Emb=async function(){var a=await g.FC();
if(!a)throw g.UB("rvdfd");return g.eC(await g.WN(a),["index","media"],{mode:"readwrite",hc:!0},function(b){var c={};return g.jC(b.objectStore("index"),{},function(d){var e=d.getKey().match(/^([\w\-_]+)\|(a|v)$/),f=g.WB.resolve(void 0);if(e){var h=e[1];e=e[2];c[h]=c[h]||{};var l;c[h][e]=g.aya(null==(l=d.getValue())?void 0:l.fmts)}else f=d.delete().then(function(){});
return g.WB.all([d.continue(),f]).then(function(m){return g.u(m).next().value})}).then(function(){for(var d={},e=g.u(Object.keys(c)),f=e.next();!f.done;f=e.next()){f=f.value;
var h=c[f].v;d[f]=c[f].a&&h?1:2}var l=Cmb(d);return g.Vna(b.objectStore("media"),{},function(m){var n=m.getKey().match(g.gya);n&&d[n[1]]||b.objectStore("media").delete(m.getKey());return m.continue()}).then(function(){return l})})})},Fmb=async function(a,b){var c=await g.FC();
if(!c)throw g.UB("wct");await g.eC(await g.WN(c),["captions"],{mode:"readwrite",hc:!0},function(d){var e=[];d=d.objectStore("captions");for(var f=0;f<b.length;f++){var h=g.fC(d,b[f],a+"|"+b[f].metadata.vss_id);e.push(h)}return g.WB.all(e)})},Gmb=async function(a){a=IDBKeyRange.bound(a+"|",a+"~");
var b=await g.FC();if(!b)throw g.UB("gactfv");return(await g.WN(b)).getAll("captions",a)},Hmb=async function(a){g.VN(a,0);
return Dmb(a)},Imb=function(a){return{context:g.BQ(),
videoIds:a}},Jmb=function(a){return{context:g.BQ(),
playlistIds:a}},Kmb=function(a){return{context:g.BQ(),
offlinePlaylistSyncChecks:a}},Lmb=function(a,b,c,d,e,f){a={entityKey:a};
c&&(a.refreshData=c);d&&(a.isExpiredStreamUrlRefetch=d);e&&(a.downloadParameters=e);f&&(a.offlineSourceData=f);return{context:g.wKa(b),signatureTimestamp:19563,videos:[a]}},l7=function(a,b,c){g.hG(new g.sB("Woffle: "+a,c?{cotn:c}:""));
b instanceof Error&&g.hG(b)},Mmb=async function(a){var b=await g7(a,{mode:"readonly",
hc:!0},function(m){return a7(m,"playbackData").then(function(n){var p=n.map(function(t){return t.transfer}).filter(function(t){return!!t}),q=n.map(function(t){return t.offlineVideoPolicy}).filter(function(t){return!!t});
p=a7(m,"transfer",p);q=a7(m,"offlineVideoPolicy",q);return g.WB.all([p,q]).then(function(t){var x=g.u(t);t=x.next().value;x=x.next().value;return[n,t,x]})})});
a=await g7(a,{mode:"readonly",hc:!0},function(m){return a7(m,"mainDownloadsListEntity").then(function(n){var p,q;return null!=(q=null==(p=n[0])?void 0:p.downloads)?q:[]})});
var c=g.u(b);b=c.next().value;var d=c.next().value;c=c.next().value;var e={},f={},h={};d=g.u(d);for(var l=d.next();!l.done;l=d.next())(l=l.value)&&(e[l.key]=l);c=g.u(c);for(d=c.next();!d.done;d=c.next())(d=d.value)&&(f[d.key]=d);a=g.u(a);for(c=a.next();!c.done;c=a.next())d=void 0,h[null!=(d=c.value.videoItem)?d:""]=!0;return{offlineVideos:b.map(function(m){var n=e[m.transfer],p=f[m.offlineVideoPolicy],q=g.KN(p.key).entityId;m=g.LN(q,"mainVideoEntity");if("OFFLINE_VIDEO_POLICY_ACTION_DISABLE"===p.action){var t=
"OFFLINE_VIDEO_STATE_DISABLED";p.expirationTimestamp&&Number(p.expirationTimestamp)<Date.now()/1E3&&(t="OFFLINE_VIDEO_STATE_EXPIRED");p=t}else if("OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED"===p.action)p="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(null==n?void 0:n.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":t="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":t="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":t="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";
break;case "TRANSFER_STATE_FAILED":t="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":t="OFFLINE_VIDEO_STATE_PLAYABLE";break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":t="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:t="OFFLINE_VIDEO_STATE_UNKNOWN"}if("OFFLINE_VIDEO_STATE_OFFLINE_FAILED"===t)switch(null==n?void 0:n.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":t="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";
break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":t="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":t="OFFLINE_VIDEO_STATE_NETWORK_ERROR"}p=t}q={id:q,videoState:p};if(null==n?0:n.cotn)q.cotn=n.cotn;if(null==n?0:n.maximumDownloadQuality)q.selectedVideoQuality=null==n?void 0:n.maximumDownloadQuality;q.selectedOfflineMode=h[m]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";return q})}},Nmb=async function(a){a=await Mmb(a);
g.IB("offlineStateSnapshot",a)},m7=function(a){g.y.call(this);
var b=this;this.api=a;this.Qd={Lbb:function(){return b.j},
dcb:function(){return b.u}};
"undefined"!==typeof g.va.BroadcastChannel&&(this.j=new g.va.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.tB()),this.j.onmessage=this.B.bind(this),this.u=new g.va.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.tB()),this.u.onmessage=this.C.bind(this))},n7=function(a,b){a.api.Pa("onOfflineOperationFailure",b);
var c;null==(c=a.j)||c.postMessage(b)},Omb=function(){this.locks=navigator.locks},Pmb=function(){try{var a=g.Aa("ytglobal.locks_");
if(a)return a;var b;if(b=navigator){var c=navigator;b="locks"in c&&!!c.locks}if(b)return g.va.localStorage&&g.va.localStorage.getItem("noop"),a=new Omb,g.za("ytglobal.locks_",a),a}catch(d){}},Qmb=function(a,b,c,d){var e=this;
this.V=a;this.ma=b;this.visibility=c;this.N=d;this.D=this.K=this.J=this.B=this.j=!1;this.C=new g.yq(function(){e.XI()});
this.Qd={mV:function(){return e.u},
XI:function(){e.XI()},
jcb:function(){return e.C}};
this.visibility.subscribe("visibilitystatechange",function(){e.Pg()})},Rmb=function(a){if(!a.B&&!a.j){var b=Pmb();
if(b){a.B=!0;var c=g.tB("OfflineLockManager");b.request("woffle_orchestration_leader:"+c,{},async function(){try{a.u=new g.Lk,a.j=!0,a.B=!1,await a.V(),await a.u.promise}catch(e){var d;(null==(d=a.N)?0:d.call(a,"wo_relinquish_leadership_on_lock_request_error"))||a.XI();e instanceof Error&&(d=e,d.args=[{name:"WoLockManagerError",xI:e.name}],g.gG(d))}})}}},Smb=function(a){a.j&&(a.D=!0,o7(a))},Tmb=function(a,b){a.j&&(a.J=b,o7(a))},Umb=function(a,b){a.j&&(a.K=b,o7(a))},o7=function(a){a.K&&a.J&&a.D&&a.visibility.isBackground()?
g.zq(a.C,6E4):a.C.stop()},p7=function(a,b){var c=b.zl,d=b.offlineModeType;
a.encryptedVideoId=b.videoId;a.cotn=null==c?void 0:c.cotn;a.offlineabilityFormatType=null==c?void 0:c.maximumDownloadQuality;var e;a.isRefresh=null!=(e=null==c?void 0:c.isRefresh)?e:!1;var f;a.softErrorCount=null!=(f=null==c?void 0:c.transferRetryCount)?f:0;a.offlineModeType=null!=d?d:"OFFLINE_NOW";g.IB("offlineTransferStatusChanged",a)},Vmb=function(a,b,c,d){d={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!d};b&&c&&(b=Math.floor(b/1024).toFixed(),c=Math.floor(c/1024).toFixed(),d.alreadyDownloadedKbytes=b,d.totalFetchedKbytes=b,d.totalContentKbytes=c);p7(d,a)},Wmb=function(a){p7({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},a)},Xmb=function(a){switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
q7=function(a){var b,c,d;
return 0<(null!=(d=null==(b=a.actionMetadata)?void 0:null==(c=b.retryScheduleIntervalsInSeconds)?void 0:c.length)?d:0)},r7=function(a){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===a.actionType&&!!a.entityKey},s7=function(a){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"===a.actionType&&!!a.entityKey},t7=function(a){return"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===a.actionType&&!!a.entityKey},u7=async function(a,b,c,d,e){e=void 0===e?!1:e;
var f=g.LN(a,b),h=g.LN(a,"downloadStatusEntity");a=await g7(c,{mode:"readonly",hc:!0},function(n){return g.WB.all([$6(n,f,b),$6(n,h,"downloadStatusEntity")])});
var l=a.length?a[0]:void 0;if(l){var m=1<a.length?a[1]:void 0;if(m){if("DOWNLOAD_STATE_USER_DELETED"===m.downloadState&&!e)return;m.downloadState=d}else m={key:h,downloadState:d};g.LP(l,Ymb,m);await g7(c,{mode:"readwrite",hc:!0},function(n){return g.WB.all([c7(n,l,b),c7(n,m,"downloadStatusEntity")])})}},v7=function(a,b){return a.actionType===b.actionType&&a.entityKey===b.entityKey},w7=function(a){if(a&&"TRANSFER_STATE_COMPLETE"!==a.transferState&&"TRANSFER_STATE_FAILED"!==a.transferState){var b=g.KN(a.key).entityId;
p7({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:b,zl:a})}},x7=function(a){if(!a||!a.thumbnails)return[];
var b=[];a=g.u(a.thumbnails);for(var c=a.next();!c.done;c=a.next())c=c.value,c.url&&b.push(c.url);return b},Zmb=function(a,b,c){return new g.fO(a,{cotn:b,
raw_player_response:c,download_media:!0,start:Infinity,disable_watch_next:!0})},$mb=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},y7=function(a,b,c,d,e,f,h,l,m,n,p){this.entityType=a;
this.actionId=b;this.action=c;this.parentActionId=d;this.rootActionId=void 0===e?b:e;this.childActionIds=f;this.prereqActionId=h;this.postreqActionIds=l;this.hasChildActionFailed=n;this.retryScheduleIndex=0;this.j=p||Date.now();this.retryScheduleIndex=m||0},z7=function(a){if(!a.key)throw Error("Entity key is required.");
if(!a.actionProto)throw Error("OfflineOrchestrationAction is required.");var b=g.KN(a.key),c=g.KN(a.actionProto.entityKey);return new y7(c.entityType,b.entityId,a.actionProto,a.parentActionId,a.rootActionId,a.childActionIds,a.prereqActionId,a.postreqActionIds,a.retryScheduleIndex,a.hasChildActionFailed,1E3*Number(a.enqueueTimeSec))},A7=function(a){return{key:g.LN(a.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:a.action,parentActionId:a.parentActionId,rootActionId:a.rootActionId,childActionIds:a.childActionIds,prereqActionId:a.prereqActionId,postreqActionIds:a.postreqActionIds,retryScheduleIndex:a.retryScheduleIndex,hasChildActionFailed:a.hasChildActionFailed,enqueueTimeSec:(a.j/1E3).toFixed()}},B7=function(){},anb=function(){},bnb=function(a){if(a.includes(":"))throw Error("Invalid user cache name: "+a);
return a+":"+g.tB("CacheStorage get")},dnb=async function(){return void 0!==cnb?cnb:cnb=new Promise(async function(a){try{await C7.open("test-only"),await C7.delete("test-only")}catch(b){if(b instanceof Error&&"SecurityError"===b.name){a(!1);
return}}a("caches"in window)})},fnb=async function(){if(await dnb())return enb||(enb=new anb),enb},gnb=async function(){var a=await fnb();
return a?a.delete("yt-player-local-img"):!0},D7=async function(a){var b=await fnb();
if(!b)throw Error("Cache API not supported");if(a.length){var c=await b.open("yt-player-local-img");await Promise.all(a.map(function(d){return c.delete(d)}))}},E7=async function(a){var b=await fnb();
if(!b)throw Error("Cache API not supported");a.length&&await (await b.open("yt-player-local-img")).addAll(a)},F7=async function(a,b,c,d){var e=g.LN(a,"ytMainVideoEntity"),f=g.LN(a,"mainVideoEntity"),h=g.LN(a,"ytMainChannelEntity"),l=g.LN(a,"transfer"),m=await g7(b,{mode:"readonly",
hc:!0},function(Q){return g.WB.all([$6(Q,e,"ytMainVideoEntity"),$6(Q,f,"mainVideoEntity"),$6(Q,h,"ytMainChannelEntity"),$6(Q,l,"transfer"),a7(Q,"ytMainChannelEntity"),a7(Q,"offlineOrchestrationActionWrapperEntity")])}),n=g.u(m),p=n.next().value,q=n.next().value,t=n.next().value;
m=n.next().value;var x=n.next().value;n=n.next().value;if(p||q||t)p=p?x7(p.thumbnail):q?x7(q.thumbnail):[],t=t?await hnb(t,x):[],await D7(p.concat(t));var z=[],D=g.LN(a,"ytMainDownloadedVideoEntity"),I=g.LN(a,"mainVideoEntity"),N=g.LN(a,"downloadStatusEntity");t=g.u(n);for(x=t.next();!x.done;x=t.next())x=x.value,n=g.KN(x.key).entityId,p=z7(x),p=g.KN(p.action.entityKey).entityId,n!==a&&p!==a||v7(c,x.actionProto)||z.push(x.key);await g7(b,{mode:"readwrite",hc:!0},function(Q){var P=z.map(function(ma){return d7(Q,
ma)});
P.push(d7(Q,D,{Gs:!0}));P.push(d7(Q,I,{Gs:!0}));P.push(d7(Q,N,{Gs:!0}));return g.WB.all(P)});
w7(m);n7(d,{entityKey:I,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},knb=async function(a,b,c,d){var e=g.LN(a,"mainPlaylistEntity"),f=g.LN(a,"ytMainChannelEntity"),h=await g7(b,{mode:"readonly",
hc:!0},function(D){return g.WB.all([$6(D,e,"mainPlaylistEntity"),$6(D,f,"ytMainChannelEntity"),a7(D,"mainPlaylistEntity"),a7(D,"mainDownloadsListEntity"),a7(D,"ytMainChannelEntity"),a7(D,"offlineOrchestrationActionWrapperEntity")])}),l=g.u(h);
h=l.next().value;var m=l.next().value,n=l.next().value,p=l.next().value,q=l.next().value;l=l.next().value;if(h||m){var t=h?inb(h):[];m=m?await hnb(m,q):[];await D7(t.concat(m))}var x=[];m=g.u(l);for(q=m.next();!q.done;q=m.next())q=q.value,l=g.KN(q.key).entityId,t=z7(q),l!==a&&t.rootActionId!==a||v7(c,q.actionProto)||x.push(q.key);var z=g.LN(a,"mainPlaylistEntity");await g7(b,{mode:"readwrite",hc:!0},function(D){var I=x.map(function(N){return d7(D,N)});
I.push(d7(D,z,{Gs:!0}));return g.WB.all(I)});
if(h&&(a=await jnb(h,n,p),a.reverse(),a))for(a=g.u(a),h=a.next();!h.done;h=a.next())await F7(h.value,b,c,d)},mnb=async function(a,b,c){var d=g.LN("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
a=await g7(a,{mode:"readwrite",hc:!0},function(f){var h=a7(f,"transfer"),l=a7(f,"offlineOrchestrationActionWrapperEntity"),m=$6(f,d,"mainDownloadsListEntity");return g.WB.all([h,l,m]).then(function(n){n=g.u(n);var p=n.next().value,q=n.next().value;n=n.next().value;var t=lnb.map(function(N){return nmb(f,N)});
q=g.u(q);for(var x=q.next();!x.done;x=q.next()){x=x.value;var z=g.KN(x.actionProto.entityKey).entityType,D="ytMainDownloadedVideoEntity"===z;z="mainVideoEntity"===z;var I="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===x.actionProto.actionType;v7(b,x.actionProto)||D&&(!D||I)&&z&&(!z||I)||t.push(d7(f,x.key,{Gs:!0}))}n&&(n.downloads=[],t.push(c7(f,n,"mainDownloadsListEntity")));return g.WB.all(t).then(function(){return p})})});
a=g.u(a);for(var e=a.next();!e.done;e=a.next())e=e.value,w7(e),e=g.KN(e.key).entityId,e=g.LN(e,"mainVideoEntity"),n7(c,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});await gnb()},inb=function(a,b){var c=[];
if(a.thumbnailStyleData){a=g.u(a.thumbnailStyleData);for(var d=a.next();!d.done;d=a.next()){var e=void 0,f=void 0,h=void 0;c=c.concat(x7(null==(e=d.value)?void 0:null==(f=e.value)?void 0:null==(h=f.collageThumbnail)?void 0:h.coverThumbnail))}}b=x7(b);return c.concat(b)},jnb=async function(a,b,c){var d=[],e=new Set;
if(c.length){c=g.u(c);for(var f=c.next();!f.done;f=c.next()){f=f.value;var h=void 0;if(null==(h=f.downloads)?0:h.length)for(f=g.u(f.downloads),h=f.next();!h.done;h=f.next())h=h.value,h.videoItem&&(h=g.KN(h.videoItem).entityId,e.add(h))}}if(a.videos){c=g.u(a.videos);for(f=c.next();!f.done;f=c.next())f=JSON.parse(g.KN(f.value).entityId),f.videoId&&!e.has(f.videoId)&&d.push(f.videoId);b=g.u(b);for(e=b.next();!e.done;e=b.next())if(e=e.value,e.key!==a.key&&(e=e.videos))for(e=g.u(e),c=e.next();!c.done;c=
e.next())c=JSON.parse(g.KN(c.value).entityId),c.videoId&&(c=d.indexOf(c.videoId),-1!==c&&d.splice(c,1))}return d},hnb=async function(a,b){var c=x7(a.avatar);
b=g.u(b);for(var d=b.next();!d.done;d=b.next())if(d=d.value,d.id!==a.id){d=g.u(x7(d.avatar));for(var e=d.next();!e.done;e=d.next())e=c.indexOf(e.value),-1!==e&&c.splice(e,1)}return c},nnb=async function(a){var b=g.O(a.frameworkUpdates,G7);
a.frameworkUpdates&&b&&await Amb(b)},qnb=function(a){var b;
if(null!=(b=a.onResponseReceivedActions)&&b.length){var c;a=null==(c=g.O(g.O(a.onResponseReceivedActions[0],onb),pnb))?void 0:c.actions;if(null!=a&&a.length)return a}},rnb=async function(a){if(!a)return[];
a=await i7(a,H7,"mainDownloadsListEntity");var b;return(null==a?0:null==(b=a.downloads)?0:b.length)?a.downloads.map(function(c){var d;return null!=(d=c.videoItem)?d:""}):[]},tnb=async function(a,b){var c=await snb(a,b);
c&&await g7(a,{mode:"readwrite",hc:!0},function(d){var e=[c7(d,c.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];c.mainDownloadsListEntity&&e.push(c7(d,c.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.WB.all(e)})},snb=async function(a,b){var c=g.LN("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.LN("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");
a=await g7(a,{mode:"readonly",hc:!0},function(p){return g.WB.all([$6(p,c,"mainDownloadsLibraryEntity"),$6(p,d,"mainDownloadsListEntity")])});
var e=g.u(a);a=e.next().value;e=e.next().value;a||(a={id:c});b=g.u(b);for(var f=b.next();!f.done;f=b.next())if(f=f.value,f===H7){if(a.smartDownloadsList)return;a.smartDownloadsList=f}else{var h=g.KN(f).entityType,l={};"mainPlaylistEntity"===h?l.playlistItem=f:"mainVideoEntity"===h&&(l.videoItem=f);if(!g.Oc(l)){h=void 0;if(null==(h=e)?0:h.downloads){h=!1;for(var m=g.u(e.downloads),n=m.next();!n.done;n=m.next())if(n=n.value,n.playlistItem===f||n.videoItem===f){h=!0;break}h||e.downloads.push(l)}else e=
{id:d,downloads:[l]};a.downloadsList=d}}return{mainDownloadsLibraryEntity:a,mainDownloadsListEntity:e}},unb=async function(a,b){var c=g.LN("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.LN("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),e=await g7(a,{mode:"readonly",
hc:!0},function(p){return g.WB.all([$6(p,c,"mainDownloadsLibraryEntity"),$6(p,d,"mainDownloadsListEntity"),$6(p,H7,"mainDownloadsListEntity")])});
e=g.u(e);var f=e.next().value,h=e.next().value,l=e.next().value;if(f){if(b===H7&&(null==l?0:l.downloads))l.downloads=[];else if(null==h?0:h.downloads){e=g.KN(b).entityType;for(var m=0;m<h.downloads.length;m++){var n=h.downloads[m];if("mainVideoEntity"===e&&n.videoItem===b){h.downloads.splice(m,1);break}else if("mainPlaylistEntity"===e&&n.playlistItem===b){h.downloads.splice(m,1);break}}}await g7(a,{mode:"readwrite",hc:!0},function(p){var q=[c7(p,f,"mainDownloadsLibraryEntity")];h&&q.push(c7(p,h,"mainDownloadsListEntity"));
l&&q.push(c7(p,l,"mainDownloadsListEntity"));return g.WB.all(q)})}},I7=function(a){this.j=a},vnb=async function(a,b){var c=new Map;
b=g.u(b);for(var d=b.next();!d.done;d=b.next())d=d.value,c.set(d,await a.u(d));return c},J7=function(a,b,c,d,e,f){b=g.LN(b,c);
d=Object.assign({},f,{priority:d,retryScheduleIntervalsInSeconds:e});return{actionType:a,entityKey:b,actionMetadata:d}},K7=function(a,b,c,d,e){this.status=a;
this.j=b;this.C=c;this.u=d;this.B=e},wnb=function(a,b,c){this.j=a;
this.Z=b;this.B=c},Bnb=async function(a,b){var c=b.entityKey,d,e=null==(d=g.O(b.actionMetadata,xnb))?void 0:d.isEnqueuedForExpiredStreamUrlRefetch;
try{d=void 0;a.Z.N("html5_enable_oduc")&&(d=await ynb(a,b));var f=g.O(b.actionMetadata,xnb);var h=f?{maximumDownloadQuality:f.maximumDownloadQuality}:void 0;var l=await znb(a,c,{isEnqueuedForExpiredStreamUrlRefetch:e,m_:h,offlineSourceData:d});if(!l)return L7(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",q7(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR");await Anb(a,l,b);return L7(b,!0,
l.orchestrationActions)}catch(m){return c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.PB&&"QUOTA_EXCEEDED"===m.type&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),l7("PDE handleAdd error"),h=g.KN(b.entityKey).entityId,await u7(h,"mainVideoDownloadStateEntity",a.j,q7(b)?"DOWNLOAD_STATE_RETRYABLE_FAILURE":"DOWNLOAD_STATE_FAILED"),L7(b,!1,void 0,c,e)}},
Cnb=async function(a,b){var c=b.entityKey,d=await g7(a.j,{mode:"readonly",
hc:!0},function(l){var m=$6(l,c,"playbackData"),n=$6(l,g.LN(g.KN(b.entityKey).entityId,"offlineVideoPolicy"),"offlineVideoPolicy");l=$6(l,g.LN(g.KN(b.entityKey).entityId,"transfer"),"transfer");return g.WB.all([m,n,l])});
d=g.u(d);var e=d.next().value,f=d.next().value;d=d.next().value;if(!e||!f)return L7(b,!0);e={lastPlayerResponseTimestampSeconds:e.playerResponseTimestamp,offlineToken:f.offlineToken};f={};if(null==d?0:d.maximumDownloadQuality)f.maximumDownloadQuality=d.maximumDownloadQuality;try{d=void 0;a.Z.N("html5_enable_oduc")&&(d=await ynb(a,b));var h=await znb(a,c,{refreshData:e,m_:f,offlineSourceData:d});if(!h)return L7(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",q7(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR");await Anb(a,h,b);return L7(b,!0,h.orchestrationActions)}catch(l){return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.PB&&"QUOTA_EXCEEDED"===l.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L7(b,!1,void 0,a,h)}},ynb=async function(a,b){b=g.KN(b.entityKey).entityId;
b=g.LN(b,"videoDownloadContextEntity");a=await i7(a.j,b,"videoDownloadContextEntity");if(null!=a&&a.offlineModeType)return{offlineModeType:a.offlineModeType}},znb=async function(a,b,c){var d=g.cS();
a=Lmb(b,a.Z,c.refreshData,c.isEnqueuedForExpiredStreamUrlRefetch,c.m_,c.offlineSourceData);b=g.QR(Dnb);return g.EQ(d,a,b).then(function(e){return e})},Anb=async function(a,b,c){if(b.frameworkUpdates&&g.O(b.frameworkUpdates,G7)){if(g.O(b.frameworkUpdates,G7).mutations&&0<g.O(b.frameworkUpdates,G7).mutations.length&&"ENTITY_MUTATION_TYPE_DELETE"===g.O(b.frameworkUpdates,G7).mutations[0].type){var d=g.KN(g.O(b.frameworkUpdates,G7).mutations[0].entityKey).entityId;
await F7(d,a.j,c,a.B)}await Amb(g.O(b.frameworkUpdates,G7))}},L7=function(a,b,c,d,e){for(var f=q7(a),h=g.u(c||[]),l=h.next();!l.done;l=h.next())if(l=l.value,l.actionMetadata){var m=void 0;
l.actionMetadata.priority=(null==(m=a.actionMetadata)?void 0:m.priority)||1}return new K7(b?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,c,d,e)},Enb=function(a,b){this.j=a;
this.Z=b},Gnb=async function(a,b){var c=q7(b);
if(await i7(a.j,b.entityKey,"transfer"))return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{await Fnb(a,b)}catch(d){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Hnb=async function(a,b){var c=q7(b),d=await i7(a.j,b.entityKey,"transfer");
if(!d||"TRANSFER_STATE_COMPLETE"!==d.transferState)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{await Fnb(a,b,!0)}catch(e){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Inb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=await g7(a.j,{mode:"readonly",
hc:!0},function(l){var m=$6(l,b.entityKey,"transfer"),n=void 0;a.Z.N("html5_oduc_transfer_logging")&&(n=$6(l,g.LN(d,"videoDownloadContextEntity"),"videoDownloadContextEntity"));return g.WB.all([m,n])}),f=g.u(e);
e=f.next().value;f=f.next().value;if(!e||"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"!==e.transferState)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{e.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";await h7(a.j,e,"transfer");var h=g.KN(e.key).entityId;p7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:h,zl:e,offlineModeType:null==f?void 0:f.offlineModeType})}catch(l){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Fnb=async function(a,b,c){c=void 0===c?!1:c;
var d=g.O(b.actionMetadata,Jnb),e=g.KN(b.entityKey).entityId,f=g.LN(e,"downloadStatusEntity"),h=await g7(a.j,{mode:"readonly",hc:!0},function(p){var q=$6(p,f,"downloadStatusEntity"),t=void 0;a.Z.N("html5_oduc_transfer_logging")&&(t=$6(p,g.LN(e,"videoDownloadContextEntity"),"videoDownloadContextEntity"));return g.WB.all([q,t])}),l=g.u(h);
h=l.next().value;l=l.next().value;var m="TRANSFER_STATE_TRANSFER_IN_QUEUE";"DOWNLOAD_STATE_USER_DELETED"===(null==h?void 0:h.downloadState)&&(m="TRANSFER_STATE_PAUSED_BY_USER");var n={key:b.entityKey,transferState:m,cotn:g.oG(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:null==d?void 0:d.maximumDownloadQuality,preferredAudioTrack:null==d?void 0:d.preferredAudioTrack,transferRetryCount:0,isRefresh:c,hasLoggedFirstStarted:!1};await g7(a.j,{mode:"readwrite",hc:!0},function(p){var q=
[];c&&q.push(d7(p,g.LN(e,"offlineVideoStreams")));q.push(c7(p,n,"transfer"));return g.WB.all(q)});
p7({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:e,zl:n,offlineModeType:null==l?void 0:l.offlineModeType})},Knb=function(){this.j=new Map},Mnb=function(){Lnb||(Lnb=new Knb);
return Lnb},Nnb=function(a,b){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:a},metadata:b,statusCode:void 0,csn:void 0,can:void 0}},Onb=function(a,b,c){if(!c){var d=void 0===d?!1:d;
c=a.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!c||d)c=g.oG(16),a.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",c)}a={flowNonce:c,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:b.eventType};b.metadata&&(a.flowMetadata=b.metadata);void 0!==b.statusCode&&(a.flowEventStatus=b.statusCode);b.csn&&(a.csn=b.csn);b.can&&(a.can=b.can);g.IB("flowEvent",a,void 0)},Qnb=function(a,b,c,d){if(!a.action.entityKey)throw Error("entityKey is missing.");
var e=g.KN(a.action.entityKey);a={entityType:e.v4,entityId:e.entityId,offlineOrchestrationActionType:a.action.actionType,orchestrationAction:{orchestrationActionId:a.actionId}};b&&(a.offlineOrchestrationActionResult=b.status,a.isRetryable=c?!1:b.j,b.B&&(a.offlineOrchestrationFailureReason=Pnb(b.B,a.isRetryable)));d&&(a.additionalOrchestrationActions=d.map(function(f){return{orchestrationActionId:f.actionId}}));
return a},Pnb=function(a,b){return"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"!==a||b?"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"===a&&b?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":a:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Rnb=function(a,b){var c={offlineOrchestrationContext:Qnb(a)};
b=Nnb(b,c);Onb(Mnb(),b,a.rootActionId)},Snb=function(a,b,c,d){d=void 0===d?[]:d;
b={offlineOrchestrationContext:Qnb(a,b,c,d)};b=Nnb(3,b);Onb(Mnb(),b,a.rootActionId)},Tnb=function(){this.actions=[]},Unb=function(a,b){if(b)for(var c=0;c<a.actions.length;c++)a.actions[c].rootActionId===b&&a.actions[c].actionId!==b&&(a.actions.splice(c,1),c--)},Vnb=function(a,b){a=g.u(a.actions);
for(var c=a.next();!c.done;c=a.next())if(c.value.actionId===b)return!0;return!1},M7=function(a,b,c,d){g.y.call(this);
var e=this;this.u=a;this.Ba=b;this.oa=c;this.K=d;this.j=new Tnb;this.J=new g.rD;this.B=new g.yq(function(){e.retry()});
this.V=NaN;this.D=!1;this.Qd={hcb:function(){return e.j},
qV:function(){return e.J},
ncb:function(){return e.B},
retry:function(){return e.retry()}};
g.E(this,this.B);this.ma=tmb(this.u,this.qa.bind(this))},Ynb=async function(a,b,c,d){a=new M7(a,b,c,d);
await Wnb(a);Xnb(a);return a},Xnb=function(a){var b=a.j.actions[0];
return a.C?("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===(null==b?void 0:b.action.actionType)&&"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"!==a.C[0].action.actionType&&(a.D=!0),Promise.resolve()):Znb(a)},Znb=async function(a){if(a.C)throw Error("Already processing an action");
if(!a.isDisposed()){var b=a.j.actions.shift();Tmb(a.oa,!b);if(void 0!==b){"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"===b.action.actionType&&"DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"===b.actionId&&Unb(a.j,b.actionId);var c="";"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"===b.action.actionType&&b.rootActionId===b.actionId&&(c=b.actionId);var d=[b];a.C=d;if(b=a.Ba[b.entityType]){for(var e=g.u(d),f=e.next();!f.done;f=e.next())Rnb(f.value,2);try{var h=await vnb(b,d.map(function(q){return q.action})),l=
g.u(d);
for(f=l.next();!f.done;f=l.next()){var m=f.value,n=h.get(m.action);await $nb(a,m,n)}Unb(a.j,c)}catch(q){l7("Orchestration error",q);try{await aob(a,d)}catch(t){l7("Orchestration retry error",t);var p=g.u(d);for(f=p.next();!f.done;f=p.next())bob(a,f.value)}}finally{a.C=void 0}}else a.C=void 0;await Znb(a)}}},$nb=async function(a,b,c){var d=3===b.retryScheduleIndex+2;
if("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"===c.status){var e=void 0;try{var f;e=null==(f=c.C)?void 0:f.map(function(m){return a.createAction(m,b)})}catch(m){Snb(b,c,d);
n7(a.K,{entityKey:b.action.entityKey,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"});l7("Orchestration subactions creation error",m);return}Snb(b,c,d,e);if(e){for(var h=e.map(function(m){return A7(m)}),l=0;l<e.length&&!a.D;)await g7(a.u,{mode:"readwrite",
hc:!0},function(m){var n=[];n.push(kmb(m,h.slice(l,l+10),"offlineOrchestrationActionWrapperEntity"));return g.WB.all(n)}),l+=10;
if(a.D){a.D=!1;return}}c=A7(b);await vmb(a.u,c.key);Rnb(b,4)}else"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"===c.status&&(Snb(b,c,d),c.j&&3>b.retryScheduleIndex+1?await aob(a,[b]):(n7(a.K,{entityKey:b.action.entityKey,failureReason:(null==c?0:c.u)?c.u:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN"}),l7("Orchestration result is not retryable, deleting action"),await vmb(a.u,A7(b).key)))},bob=function(a,b){if(3>b.retryScheduleIndex){a=a.j;
b=g.u([b]);for(var c=b.next();!c.done;c=b.next())c=c.value,Rnb(c,1),a.actions.push(c);a.actions.sort(a.j)}},fob=async function(a,b){var c=[],d=Infinity,e=4E3;
b=g.u(b);for(var f=b.next();!f.done;f=b.next()){f=f.value;var h=Number(f.enqueueTimeSec),l=cob(h),m=f.retryScheduleIndex;m=null!=m&&0<m;0<l&&m?(d=Math.min(d,h),e=Math.min(l,e)):c.push(f)}isFinite(d)&&(!a.B.isActive()||d<a.V)&&(a.V=d,a.B.start(e));a.J.ji()||(d=c.length,c=c.filter(function(n){var p;n=(null==(p=n.actionProto)?void 0:p.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!dob.includes(n)}),d=c.length<d,!a.B.isActive()&&d&&a.B.start(1));
0<c.length&&eob(a,c);await Xnb(a)},hob=async function(a){var b=await gob(a),c=[];
b=g.u(b);for(var d=b.next();!d.done;d=b.next()){d=d.value;var e=g.KN(d.key).entityId;Vnb(a.j,e)||c.push(d)}await fob(a,c)},cob=function(a){a=1E3*a-Date.now();
return 4E3<a?4E3:a},aob=async function(a,b){for(var c=g.u(b),d=c.next();!d.done;d=c.next()){var e=void 0,f=void 0;
d=d.value;var h=(null==(f=d.action)?void 0:null==(e=f.actionMetadata)?void 0:e.retryScheduleIntervalsInSeconds)||[1,2,4];e=1;d.retryScheduleIndex<h.length&&(e=h[d.retryScheduleIndex]);d.j=1E3*e+Date.now();d.retryScheduleIndex++}await iob(a,b)},Wnb=async function(a){var b=await j7(a.u,"offlineOrchestrationActionWrapperEntity");
await fob(a,b)},eob=function(a,b){0!==b.length&&b.forEach(function(c){c=z7(c);
bob(a,c)})},gob=async function(a,b){return(await j7(a.u,"offlineOrchestrationActionWrapperEntity",b)).filter(Bmb)},iob=function(a,b){if(0===b.length)return Promise.resolve([]);
b=b.map(function(c){return A7(c)});
return umb(a.u,b)},job=function(){this.j=void 0},lob=async function(a,b){var c=b.videoId,d=b.W(),e=!0;
if(b.captionTracks.length){var f=Bkb(b);a.j=new g.aU(d,b,f)}else if(b.Ed)a.j=new g.dU(d,b.Ed,c,g.Hza(b),b.Gm,b.eventId),e=b.Gm;else return;return new Promise(function(h){var l;null==(l=a.j)||l.Iz(async function(){await kob(a,c,e);h()})})},kob=async function(a,b,c){if(a.j){var d=[],e=g.XT(a.j.j,void 0===c?!0:c),f=[];
for(c={gx:0};c.gx<e.length;c={gx:c.gx},c.gx++){var h=a.j.Kv(e[c.gx],"json3");h=g.$z(h,{withCredentials:!0,format:"RAW"},3,500).then(function(l){return function(m){m={metadata:g.lN(e[l.gx]),trackData:m.xhr.responseText};f.push(m)}}(c)).Dk(function(l){l7("Caption fetch error",l)});
d.push(h)}await Ckb(d);try{await Fmb(b,f)}catch(l){l7("Caption DB transaction error",l)}}},mob=async function(a){a=await Gmb(a);
return!!a&&0<a.length},nob=function(a,b){this.api=a;
this.j=b;this.logger=new g.FW("woffle");this.u=!1;this.Qd={QM:this.QM}},oob=async function(a){return Hmb(a)},pob=async function(a){return(await g.cya(a)).filter(function(b){return!!b.url}).map(function(b){return b.url})},N7=function(a,b){var c=g.UN(b);
if(1===c||0===c)return Promise.resolve();(c=qob(a,b))&&c.stopVideo();a.B=0;return oob(b)},O7=function(a,b,c,d){c=void 0===c?!1:c;
d=void 0===d?!0:d;var e="string"===typeof b?b:b.videoDetails.videoId;2===g.UN(e)&&((b=qob(a,e))?b.stopVideo():a.logger.info(function(){return"Corresponding player for "+e+" not found. Pausing anyway"}),g.VN(e,2),a.B=2,c?rob(a.j):d&&sob(a.j))},qob=function(a,b){var c;
return(null==(c=a.player)?void 0:c.getVideoData().videoId)===b?a.player:null},P7=function(a){g.y.call(this);
this.j=a;this.u=tmb(this.j,this.B.bind(this))},tob=async function(a,b){if(0===b.length)return[];
var c=b.map(function(e){return g.LN(e,"transfer")}),d=(await j7(a.j,"transfer",c)).filter(Bmb).map(function(e){return g.KN(e.key).entityId});
a=b.filter(function(e){return-1===d.indexOf(e)});
if(0===a.length)return[];b=g.u(a);for(c=b.next();!c.done;c=b.next())await oob(c.value);return a},vob=async function(a,b,c,d,e,f){var h="STREAM_TYPE_UNKNOWN";
c.video&&c.audio?(h="STREAM_TYPE_AUDIO_AND_VIDEO",l7("unexpected stream type")):c.video&&!c.audio?h="STREAM_TYPE_VIDEO":!c.video&&c.audio&&(h="STREAM_TYPE_AUDIO");var l=g.LN(b,"offlineVideoStreams"),m={numBytesDownloaded:e.toFixed(),numTotalBytes:f.toFixed(),streamType:h,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(d),itag:"STREAM_TYPE_AUDIO_AND_VIDEO"===h?Number(c.itag):void 0};await g7(a,{mode:"readwrite",hc:!0},function(n){var p=$6(n,l,"offlineVideoStreams"),
q=$6(n,g.LN(b,"transfer"),"transfer");return g.WB.all([p,q]).then(function(t){var x=g.u(t);t=x.next().value;x=x.next().value;if(!x)return d7(n,l).then(function(){});
t=[c7(n,uob(t,d,m,l),"offlineVideoStreams")];x.offlineVideoStreams||(x.offlineVideoStreams=[]);-1===x.offlineVideoStreams.indexOf(l)&&(x.offlineVideoStreams.push(l),t.push(c7(n,x,"transfer")));return g.WB.all(t)})})},wob=async function(a,b){b=g.LN(b,"offlineVideoStreams");
if((b=await i7(a,b,"offlineVideoStreams"))&&b.streamsProgress){for(var c=g.u(b.streamsProgress),d=c.next();!d.done;d=c.next())d=d.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);await h7(a,b,"offlineVideoStreams")}},uob=function(a,b,c,d){if(a&&a.streamsProgress){d=a;
a:{b=b.itag+";"+b.xtags;for(var e=a.streamsProgress,f=0;f<e.length;f++){var h=JSON.parse(e[f].formatStreamBytes);if(h.itag+";"+h.xtags===b){e[f]=c;c=e;break a}}e.push(c);c=e}d.streamsProgress=c}else a={key:d,streamsProgress:[c]};return a},xob=function(a,b,c,d){g.y.call(this);
var e=this;this.u=a;this.api=b;this.Na=c;this.ma=d;this.J=new g.rD;this.C=new g.yq(function(){e.j&&"TRANSFER_STATE_TRANSFERRING"===e.j.transferState&&e.J.ji()&&(3>(e.j.transferRetryCount||0)?O7(e.K,e.D,!1,!1):N7(e.K,e.D.videoDetails.videoId),e.xw("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Ba=0;this.V=!1;this.La=new g.FK(this);this.Qd={pcb:function(){return e.C},
acb:function(){return e.ma},
qV:function(){return e.J}};
this.oa=tmb(this.u,this.K0.bind(this));this.K=new nob(b,this);this.Ua=new job;this.qa=new P7(this.u);this.Fa=this.J.Sa("publicytnetworkstatus-online",this.DE.bind(this));this.Ga=this.J.Sa("publicytnetworkstatus-offline",this.r9.bind(this));g.E(this,this.La);this.La.T(b,"offlinetransferpause",this.s9);g.RM(this.api.W())?this.B="mainVideoDownloadStateEntity":g.FM(this.api.W())&&(this.B="musicTrackDownloadMetadataEntity")},yob=async function(a){await Emb();
a=a.qa;var b=g.TN();b=Object.keys(b);await tob(a,b)},R7=async function(a,b){b=void 0===b?!1:b;
if(a.j)throw Error("Already downloading a video");a.V=!1;var c=await zob(a);Umb(a.Na,!c);c&&a.J.ji()?(b&&await new Promise(function(d){g.Qz(d,1E3)}),await Aob(a,c)):!c&&a.j&&Q7(a)},Bob=async function(a){a.D&&(await N7(a.K,a.D.videoDetails.videoId),Q7(a))},Cob=async function(a,b){try{(b.captionTracks.length||b.Ed)&&!await mob(b.videoId)&&await lob(a.Ua,b)}catch(c){l7("Caption downloading error",c,b.cotn)}},Aob=async function(a,b){if(!a.V){a.V=!0;
a.j=b;var c=g.KN(a.j.key).entityId;if("TRANSFER_STATE_TRANSFERRING"===a.j.transferState){var d=await S7(a,c);p7({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:c,zl:a.j,offlineModeType:d})}else"TRANSFER_STATE_TRANSFER_IN_QUEUE"!==a.j.transferState||a.j.transferRetryCount||a.j.hasLoggedFirstStarted||(d=await S7(a,c),a.j.hasLoggedFirstStarted=!0,await Dob(a),Vmb({videoId:c,zl:a.j,offlineModeType:d},void 0,void 0,!0));await Eob(a);c=null;try{c=await Fob(a,
b),a.D=c}catch(f){l7("error getting player response",f,b.cotn);await a.xw("TRANSFER_FAILURE_REASON_INTERNAL");return}d=Zmb(a.api.W(),b.cotn,c);await Cob(a,d);d.Fw=await pob(d.videoId);c=a.K;b=b.maximumDownloadQuality;d.getPlayerResponse();g.VN(d.videoId,2);c.B=2;c.u=!1;var e;null==(e=c.player)||e.dispose();c.player=c.api.Qy(9,d);e={};g.HG(c.player,(e.localmediachange=c.mI,e.signatureexpired=c.YO,e.statechange=c.q7,e),c);e=c.QM(b);g.K1a(c.player,g.LH(e,e,!0,"m"),!1);g.UW(c.player,!1);a.C.start(108E5)}},
zob=async function(a){a=(await j7(a.u,"transfer")).filter(Gob).sort(Hob);
if(0!==a.length)return a[0]},Eob=async function(a){if(a.j){a.C.start(108E5);
await T7(a,"TRANSFER_STATE_TRANSFERRING");var b=a.j;(b=(null==b?0:b.key)?g.KN(b.key).entityId:"")&&a.B&&await u7(b,a.B,a.u,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS")}else U7(a,"onTransferStart")},rob=async function(a){if(a.j){var b=a.j;
a.C.stop();await T7(a,"TRANSFER_STATE_PAUSED_BY_USER");var c=(null==b?0:b.key)?g.KN(b.key).entityId:"";c&&a.B&&await u7(c,a.B,a.u,"DOWNLOAD_STATE_PAUSED");var d=await S7(a,c);Wmb({videoId:c,zl:b,offlineModeType:d})}else U7(a,"onTransferPausedByUser");Q7(a);R7(a)},sob=async function(a){if(a.j){a.C.stop();
await T7(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE");var b=a.j;(b=(null==b?0:b.key)?g.KN(b.key).entityId:"")&&a.B&&await u7(b,a.B,a.u,"DOWNLOAD_STATE_PAUSED");Q7(a)}else U7(a,"onTransferPausedByNetwork")},Iob=async function(a){if(a.j){var b=a.j;
a.C.stop();if(b&&a.D){var c=Zmb(a.api.W(),b.cotn,a.D);await Cob(a,c)}await T7(a,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE");(c=(null==b?0:b.key)?g.KN(b.key).entityId:"")&&a.B&&await u7(c,a.B,a.u,"DOWNLOAD_STATE_COMPLETE");await wob(a.u,c);var d=await S7(a,c);p7({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",statusType:"SUCCESS"},{videoId:c,zl:b,offlineModeType:d});Q7(a);R7(a)}else U7(a,"onTransferComplete")},Job=async function(a,b,c){if(a.j){"TRANSFER_STATE_TRANSFERRING"!==a.j.transferState&&
await Eob(a);
var d=Date.now();1E3<d-a.Ba&&(a.Ba=d,await vob(a.u,c.videoId,c.u,c.BM,c.bytesDownloaded,c.j),d=await S7(a,b),Vmb({videoId:b,zl:a.j,offlineModeType:d},c.bytesDownloaded,c.j));a.C.start(108E5)}else U7(a,"onTransferProgress: "+b)},Kob=function(a){var b=3>(a.j.transferRetryCount||0);
b&&(a=a.j,a.transferRetryCount=(a.transferRetryCount||0)+1);return b},Lob=async function(a,b){b=void 0===b?"TRANSFER_FAILURE_REASON_UNKNOWN":b;
a.j||U7(a,"setTransferToFailed: "+b);var c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";"TRANSFER_FAILURE_REASON_NETWORK"===b?c="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"===b&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED");await T7(a,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",b);var d;n7(a.ma,{entityKey:null==(d=a.j)?void 0:d.key,failureReason:c});c=a.j?g.KN(a.j.key).entityId:"";d=await S7(a,c);a={videoId:c,
zl:a.j,offlineModeType:d};c={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(c.transferFailureReason=b,c.failureReason=Xmb(b));p7(c,a)},T7=async function(a,b,c,d){if(a.j){a.j.transferState=b;
a.j.failureReason=d;try{await Dob(a,function(e){return c?a7(e,"offlineVideoStreams",a.j.offlineVideoStreams).then(function(f){for(var h=g.u(f),l=h.next();!l.done;l=h.next())if((l=l.value)&&l.streamsProgress){l=g.u(l.streamsProgress);for(var m=l.next();!m.done;m=l.next())m.value.streamState=c}return kmb(e,f.filter(function(n){return!!n}),"offlineVideoStreams")}):g.WB.resolve(void 0)})}catch(e){e instanceof g.PB&&"QUOTA_EXCEEDED"===e.type&&await a.xw("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE")}}else U7(a,
"saveTransferState: "+b)},Dob=async function(a,b){if(a.j){var c=a.j;
await g7(a.u,{mode:"readwrite",hc:!0},function(d){var e=[c7(d,c,"transfer")];b&&e.push(b(d));return g.WB.all(e)})}},Q7=function(a){a.j=void 0;
a.D=void 0;a.C.stop()},Fob=async function(a,b){b=g.KN(b.key).entityId;
b=g.LN(b,"playbackData");a=await i7(a.u,b,"playbackData");if(null==a?0:a.playerResponseJson)return JSON.parse(a.playerResponseJson);throw Error("No PlayerResponse found");},U7=function(a,b){a.api.ya("woffle",{mcte:b});
l7("missing current transfer entity.")},S7=async function(a,b){var c=void 0;
a.api.W().N("html5_oduc_transfer_logging")&&(c=await i7(a.u,g.LN(b,"videoDownloadContextEntity"),"videoDownloadContextEntity"));var d,e;return null!=(e=null==(d=c)?void 0:d.offlineModeType)?e:void 0},Gob=function(a){return void 0!==Mob[a.transferState]},Hob=function(a,b){var c=Mob[a.transferState],d=Mob[b.transferState];
return c!==d?c-d:Number(a.enqueuedTimestampMs)-Number(b.enqueuedTimestampMs)},V7=function(a,b){var c=this;
this.Z=a;this.api=b;this.J=new g.rD;this.B=new Qmb(function(){return Nob(c)},function(){c.LQ()},this.api.jp(),this.api.N.bind(this.api));
this.j=new m7(this.api);this.C=new g.Lk;this.Qd={mV:function(){return c.B.Qd.mV()},
qV:function(){return c.J},
bcb:function(){return c.B},
QN:function(){return c.QN()},
HQ:function(){return c.HQ()},
LQ:function(){return c.LQ()},
GE:function(){return c.GE()}};
Rmb(this.B)},Nob=async function(a){a.api.Pa("onOrchestrationBecameLeader");
await a.HQ()},Pob=async function(a){var b=await k7();
if(b){a.u=new xob(b,a.api,a.B,a.j);var c=a.BC(b);a.D=await Ynb(b,c,a.B,a.j);await Oob(a)}else l7("PES is undefined")},Oob=async function(a){if(a.u){a.u.j||await R7(a.u);
await a.refreshAllStaleEntities(43200,!0);await a.UL();a.K=g.Rz(function(){a.refreshAllStaleEntities(43200,!0);a.UL()},9E5);
g.xB(g.zB(),function(){return a.GE()});
var b=await k7();await Nmb(b);Smb(a.B)}else l7("transferManager is undefined")},Qob=async function(){var a=await k7();
if(!a)return[];for(var b=Date.now()/1E3,c=await j7(a,"offlineVideoPolicy"),d=g.u(c),e=d.next();!e.done;e=d.next())e=e.value,e.expirationTimestamp&&Number(e.expirationTimestamp)<b&&(e.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE",await h7(a,e,"offlineVideoPolicy"));return c.map(function(f){return f.key})},W7=async function(a,b,c,d,e){var f=await k7();
if(!f)return[];b=b.map(function(h){var l=g.LN(h,c);l={actionType:d,entityKey:l,actionMetadata:Object.assign({},$mb(),e)};"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"!==d&&(l.actionMetadata.priority=0);h=new y7(c,h,l);return A7(h)});
f=umb(f,b);Rmb(a.B);return f},Rob=async function(a,b,c){var d=[];
b=g.u(b);for(var e=b.next();!e.done;e=b.next())e=e.value,e.upToDate||c&&!e.shouldAutoSyncMetadata||!e.playlistId||(e=await W7(a,[e.playlistId],"mainPlaylistEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",{mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:e.checkInSeconds,autoSync:c}}))&&d.push.apply(d,g.la(e));return d},Tob=async function(a){var b=g.cS();
a=Imb(a);var c=g.QR(Sob);try{var d=await g.EQ(b,a,c)}catch(f){throw l7("GetOffline fetch request error",f),Error("GetOffline fetch request error");}if(d){var e;if(0===(null==(e=d.errorMetadata)?void 0:e.status))throw Error("Empty response body");if(!d.videos||!d.videos.length)throw Error("No data");}else throw Error("Network request failed");return d.videos.map(function(f){return f.offlineVideoData})},Uob=async function(a){var b=g.cS();
a=Jmb(a);var c=g.QR(Sob);try{var d=await g.EQ(b,a,c)}catch(f){throw l7("GetOffline fetch request error for playlist",f),Error("GetOffline fetch request error for playlist");}if(d){var e;if(0===(null==(e=d.errorMetadata)?void 0:e.status))throw Error("Empty response body");if(!d.playlists||!d.playlists.length)throw Error("No data");}else throw Error("Network request failed");return d.playlists.map(function(f){return f.offlinePlaylistData})},Wob=async function(a,b,c,d){var e=await k7();
if(!e)return[];var f=[];(null==d?0:d.length)?f=d:f=await j7(e,"mainPlaylistEntity");if(!f.length)return[];d=[];var h=Date.now()/1E3;f=g.u(f);for(var l=f.next();!l.done;l=f.next()){l=l.value;var m=l.downloadState?await i7(e,l.downloadState,"mainPlaylistDownloadStateEntity"):void 0,n=void 0,p=null==(n=l)?void 0:n.entityMetadata;n=p&&p.nextAutoRefreshIntervalSeconds?Number(p.nextAutoRefreshIntervalSeconds):NaN;var q=Number.isNaN(n)?a:n,t=n=void 0,x=(null==(n=m)?0:n.lastSyncedTimestampMillis)?Number(null==
(t=m)?void 0:t.lastSyncedTimestampMillis)/1E3:0,z=t=void 0;n=(null==(t=m)?0:t.addedTimestampMillis)?Number(null==(z=m)?void 0:z.addedTimestampMillis)/1E3:0;if(c||!p||x+q<=h){m=[];q=void 0;if(null==(q=l.videos)?0:q.length)for(q=g.u(l.videos),x=q.next();!x.done;x=q.next())x=JSON.parse(g.KN(x.value).entityId),x.videoId&&m.push(x.videoId);q="0";p&&(x=void 0,q=String(Number(null!=(x=p.offlineLastModifiedTimestampSeconds)?x:0).toFixed()));d.push({playlistId:l.playlistId,videoIds:m,offlineLastModifiedTimestamp:q,
autoSync:b,offlineDateAddedTimestamp:String(n)})}}return d.length?await Vob(d):[]},Xob=async function(){var a=await k7();
if(!a)return!1;a=await j7(a,"refresh");var b;if(null==(b=a[0])||!b.refreshTime)return!1;b=Number(a[0].refreshTime);a=Date.now()/1E3;return isFinite(b)&&a>=b},Zob=async function(a){try{var b=await Yob(a);
await nnb(b);var c=qnb(b)}catch(d){l7("getAndProcessSmartDownloadsResponse request or processing error",d)}return c},$ob=async function(a,b){var c=await k7();
if(!c)return[];var d=[];(null==b?0:b.length)?d=b:d=await j7(c,"musicPlaylist");if(!d.length)return[];b=[];Date.now();d=g.u(d);for(var e=d.next();!e.done;e=d.next()){e=e.value;var f=void 0,h=null==(f=e)?void 0:f.entityMetadata;Number.isNaN(h&&h.nextAutoRefreshIntervalSeconds?Number(h.nextAutoRefreshIntervalSeconds):NaN);h=f=0;if(e.downloadMetadata){h=await i7(c,e.downloadMetadata,"musicPlaylistDownloadMetadataEntity");var l=void 0,m=void 0;f=Number(null!=(m=null==(l=h)?void 0:l.addedTimestampMillis)?
m:"0")/1E3;m=l=void 0;h=Number(null!=(m=null==(l=h)?void 0:l.lastModifiedTimestampMillis)?m:"0")/1E3}l=[];m=void 0;if(null==(m=e.tracks)?0:m.length){m=g.u(e.tracks);for(var n=m.next();!n.done;n=m.next())l.push(g.KN(n.value).entityId)}b.push({playlistId:e.playlistId,videoIds:l,offlineLastModifiedTimestamp:String(h.toFixed()),autoSync:a,offlineDateAddedTimestamp:String(f.toFixed())})}return b.length?await Vob(b):[]},Yob=async function(a){var b=g.cS(),c=await k7(),d;
c&&(d=await Mmb(c));c=d;a={context:g.BQ(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:a},offlineClientState:c}}};c=g.QR(apb);try{var e=await g.EQ(b,a,c)}catch(f){throw l7("DPS fetch request error for smart downloads",f),Error("DPS fetch request error for smart downloads");}if(!e)throw Error("Network request failed");return e},Vob=async function(a){var b=g.cS();
a=Kmb(a);var c=g.QR(bpb);try{var d=await g.EQ(b,a,c)}catch(f){throw l7("offlinePlaylistSyncCheck fetch request error",f),Error("offlinePlaylistSyncCheck fetch request error");}if(d){var e;if(0===(null==(e=d.errorMetadata)?void 0:e.status))throw Error("Empty response body");if(!d.offlinePlaylistSyncCheckDatas||!d.offlinePlaylistSyncCheckDatas.length)throw Error("No data");}else throw Error("Network request failed");return d.offlinePlaylistSyncCheckDatas.map(function(f){return f.offlinePlaylistSyncCheckData})},
cpb=function(a,b,c){this.j=a;
this.Z=b;this.B=c},fpb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=[];
try{e=await dpb(a,d);var f;a.Z.N("woffle_enable_main_downloads_library")&&(null==(f=e)?0:f.length)&&await tnb(a.j,[b.entityKey])}catch(m){return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.PB&&"QUOTA_EXCEEDED"===m.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,d)}a=[];var h;if(null==
(h=e)?0:h.length)for(e=g.u(e),h=e.next();!h.done;h=e.next())if(h=h.value.offlineVideoData,f=void 0,null==(f=h)?0:f.videoId){f=void 0;var l=Number((null==(f=b.actionMetadata)?void 0:f.priority)||0)+1;a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"mainVideoEntity",l,X7,epb(b,h,d)))}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},hpb=async function(a,b){var c=q7(b),d=b.entityKey,e=g.KN(d).entityId,f=[],h=!1;
"!*$_ALL_ENTITIES_!*$"===e?(h=!0,f=await j7(a.j,"mainPlaylistEntity")):(d=await i7(a.j,d,"mainPlaylistEntity"))&&f.push(d);var l;if(null==(l=f)||!l.length)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);d=g.O(b.actionMetadata,gpb);l=null==d?void 0:d.nextAutoRefreshIntervalSeconds;d=null==d?void 0:d.autoSync;var m=[],n=!0,p=!0,q=!1;if(h||!1!==d){try{m=await Wob(0,!!d,!0,f)}catch(N){N instanceof Error&&"No data"===N.message?"!*$_ALL_ENTITIES_!*$"===e?await mnb(a.j,b,a.B):await knb(e,
a.j,b,a.B):N instanceof Error&&"Empty response body"===N.message&&l7(N.message)}if(!m.length||!h&&m[0].playlistId!==e)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)}if(h){b=[];e=g.u(m);for(var t=e.next();!t.done;t=e.next())t=t.value,t.upToDate||d&&!t.shouldAutoSyncMetadata||!t.playlistId||b.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,X7,{mainPlaylistEntityActionMetadata:{nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:d}}));return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,b)}if(m.length&&(h=m[0],q=!!h.upToDate,d)){var x;n=null!=(x=h.shouldAutoSyncMetadata)?x:!0;var z;p=null!=(z=h.shouldAutoSyncVideos)?z:!0;h.checkInSeconds&&(l=h.checkInSeconds)}if(q||!n)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);d=[];f=f[0];x=f.downloadState?await i7(a.j,f.downloadState,"mainPlaylistDownloadStateEntity"):void 0;x=(null==x?0:x.addedTimestampMillis)?String(x.addedTimestampMillis):void 0;try{d=await dpb(a,e,x,l)}catch(N){if(N instanceof Error&&"No data"===N.message)await knb(e,
a.j,b,a.B);else if(N instanceof Error&&"Empty response body"===N.message)l7(N.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.PB&&"QUOTA_EXCEEDED"===N.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,e)}if(!p)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c);a=[];l=new Map;var D;if(null==(D=d)?0:D.length)for(D=g.u(d),d=D.next();!d.done;d=D.next())d=d.value.offlineVideoData,p=void 0,(null==(p=d)?0:p.videoId)&&l.set(d.videoId,d);d=new Map;D=[];var I;if(null==f?0:null==(I=f.videos)?0:I.length)for(I=g.u(f.videos),f=I.next();!f.done;f=I.next())if(f=JSON.parse(g.KN(f.value).entityId).videoId)l.has(f)?(d.set(f,l.get(f)),l.delete(f)):D.push(f);I=Number((null==(t=b.actionMetadata)?void 0:t.priority)||0)+1;t=g.u(l.entries());for(f=t.next();!f.done;f=t.next())l=
g.u(f.value),f=l.next().value,l=l.next().value,a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",f,"mainVideoEntity",I,X7,epb(b,l,e)));t=g.u(d.entries());for(f=t.next();!f.done;f=t.next())l=g.u(f.value),f=l.next().value,l=l.next().value,a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f,"mainVideoEntity",I,X7,epb(b,l,e)));b=g.u(D);for(e=b.next();!e.done;e=b.next())a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",e.value,"mainVideoEntity",0,X7));return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,a)},ipb=async function(a,b){var c=q7(b);
try{var d=g.KN(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await mnb(a.j,b,a.B):(await knb(d,a.j,b,a.B),a.Z.N("woffle_enable_main_downloads_library")&&await unb(a.j,b.entityKey))}catch(e){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},dpb=async function(a,b,c,d){b=await Uob([b]);
a=await jpb(a,b[0],c,d);a=inb(a.mainPlaylistEntity,a.A9.avatar);try{await E7(a)}catch(e){e instanceof Error&&"Failed to fetch"===e.message&&l7(e.message)}return b[0].videos},jpb=async function(a,b,c,d){var e=Date.now().toString();
c||(c=e);var f=b.videos,h=b.playlistId,l=[],m=[];if(f){f=g.u(f);for(var n=f.next();!n.done;n=f.next()){n=n.value.offlineVideoData;if(!n||!n.videoId)throw Error("Invalid offlineVideoData");n=n.videoId;n={id:g.LN(JSON.stringify({videoId:n,playlistId:h}),"mainPlaylistVideoEntity"),video:g.LN(n,"mainVideoEntity")};l.push(n);m.push(n.id)}}f=b.channel.offlineChannelData;var p=kpb(g.LN(h,"ytMainChannelEntity"),f),q={key:g.LN(h,"mainPlaylistDownloadStateEntity"),addedTimestampMillis:c,lastSyncedTimestampMillis:e},
t={key:g.LN(h,"mainPlaylistEntity"),playlistId:h,channelOwner:p.id,videos:m,title:b.title,thumbnailStyleData:lpb(b),visibility:mpb(b),downloadState:q.key};(null==t?0:t.entityMetadata)?(t.entityMetadata.offlineLastModifiedTimestampSeconds=b.lastModifiedTimestamp,d&&(t.entityMetadata.nextAutoRefreshIntervalSeconds=String(d))):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:d?String(d):void 0,offlineLastModifiedTimestampSeconds:b.lastModifiedTimestamp});await g7(a.j,{mode:"readwrite",hc:!0},function(x){for(var z=
c7(x,t,"mainPlaylistEntity"),D=c7(x,p,"ytMainChannelEntity"),I=c7(x,q,"mainPlaylistDownloadStateEntity"),N=[],Q=g.u(l),P=Q.next();!P.done;P=Q.next())N.push(c7(x,P.value,"mainPlaylistVideoEntity"));return g.WB.all([z,D,I].concat(g.la(N)))});
return{mainPlaylistEntity:t,A9:p,Rcb:l}},kpb=function(a,b){return{id:a,
channelId:b.channelId,title:b.title,avatar:b.thumbnail}},lpb=function(a){var b=[],c=a.videos;
c&&0<c.length&&b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:c[0].offlineVideoData.thumbnail}}});if((a=a.additionalMetadadatas)&&0<a.length)for(a=g.u(a),c=a.next();!c.done;c=a.next()){var d=c.value.offlineBundleItemPlaylistData,e=void 0;c=null==(e=d)?void 0:e.style;e=void 0;d={collageThumbnail:{coverThumbnail:null==(e=d)?void 0:e.coverThumbnail}};switch(c){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:d});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:d});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:d});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:d})}}return b},mpb=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},epb=function(a,b,c){b={offlineVideoData:b,
playlistId:c};if(a=g.O(a.actionMetadata,gpb))b.maximumDownloadQuality=a.maximumDownloadQuality;return{mainVideoEntityActionMetadata:b}},npb=function(a,b,c){this.j=a;
this.Z=b;this.B=c},qpb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=g.O(b.actionMetadata,Y7),f=!(null==e?0:e.playlistId);
try{await opb(a,d,void 0,null==e?void 0:e.offlineVideoData,f)}catch(l){return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.PB&&"QUOTA_EXCEEDED"===l.type&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,d,b)}var h;a=Number((null==(h=b.actionMetadata)?void 0:h.priority)||0)+1;b=(b=g.O(b.actionMetadata,
Y7))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;d=J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d,"playbackData",a,ppb,b);return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[d])},rpb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=await i7(a.j,b.entityKey,"mainVideoEntity"),f=e?await i7(a.j,e.downloadState,"mainVideoDownloadStateEntity"):void 0;
if(!e||!f)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{var h;await opb(a,d,f.addedTimestampMillis,null==(h=g.O(b.actionMetadata,Y7))?void 0:h.offlineVideoData);e=1;var l;e=Number((null==(l=b.actionMetadata)?void 0:l.priority)||0)+1;var m=J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"playbackData",e,ppb)}catch(n){if(n instanceof Error&&"No data"===n.message)await F7(d,a.j,b,a.B);else if(n instanceof Error&&"Empty response body"===n.message)l7(n.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.PB&&"QUOTA_EXCEEDED"===n.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,a,b)}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,m?[m]:void 0)},spb=async function(a,b){var c=q7(b);
try{var d=g.KN(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await mnb(a.j,b,a.B):(await F7(d,a.j,b,a.B),a.Z.N("woffle_enable_main_downloads_library")&&await unb(a.j,b.entityKey))}catch(e){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},opb=async function(a,b,c,d,e){d||(d=(await Tob([b]))[0]);
b=await tpb(a,d,c,e);a=b.mainVideoEntity;b=b.channelEntity;try{var f=x7(a.thumbnail),h=x7(b.avatar);var l=f.concat(h);await E7(l)}catch(m){m instanceof Error&&"Failed to fetch"===m.message&&l7(m.message)}},tpb=async function(a,b,c,d){c||(c=Date.now().toString());
var e,f=null==(e=b.channel)?void 0:e.offlineChannelData,h={id:g.LN(b.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail},l={key:g.LN(b.videoId,"mainVideoDownloadStateEntity"),playbackData:g.LN(b.videoId,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.LN(b.videoId,"videoDownloadContextEntity")};c=g.LN(b.videoId,"mainVideoEntity");var m={key:c,videoId:b.videoId,title:b.title,thumbnail:b.thumbnail,localizedStrings:{viewCount:b.shortViewCountText},
lengthSeconds:b.lengthSeconds?Number(b.lengthSeconds):void 0,publishedTimestampMillis:b.publishedTimestamp?(1E3*Number(b.publishedTimestamp)).toString():void 0,formattedDescription:b.description,owner:h.id,downloadState:l.key};if(a.Z.N("woffle_enable_main_downloads_library")&&d&&(d=await snb(a.j,[c]))){var n=d.mainDownloadsLibraryEntity;var p=d.mainDownloadsListEntity}var q={key:g.LN(b.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"};g.LP(l,Ymb,q);await g7(a.j,{mode:"readwrite",
hc:!0},function(t){var x=c7(t,h,"ytMainChannelEntity"),z=c7(t,l,"mainVideoDownloadStateEntity"),D=c7(t,m,"mainVideoEntity");x=[x,z,D];n&&(z=c7(t,n,"mainDownloadsLibraryEntity"),x.push(z));p&&(z=c7(t,p,"mainDownloadsListEntity"),x.push(z));q&&(t=c7(t,q,"downloadStatusEntity"),x.push(t));return g.WB.all(x)});
return{mainVideoEntity:m,channelEntity:h}},upb=function(a,b,c){this.j=a;
this.Z=b;this.B=c},wpb=async function(a,b){var c=q7(b),d=[],e=await W6.getInstance(),f;
e&&(f=await e.get("sdois"));try{if(void 0===f)throw Error("prefStorage or opt-in state is undefined");var h=await rnb(a.j);h.reverse();if(h.length)for(var l=g.u(h),m=l.next();!m.done;m=l.next()){var n=m.value;if(n){var p=g.KN(n).entityId;await F7(p,a.j,{entityKey:n,actionType:b.actionType},a.B)}}var q=await Yob(f);await nnb(q);var t=qnb(q);a.Z.N("woffle_enable_main_downloads_library")&&(f||await unb(a.j,H7),await tnb(a.j,[H7]));if(null==t?0:t.length)for(var x=g.u(t),z=x.next();!z.done;z=x.next()){var D=
z.value;a=D;var I=a.entityKey,N=a.actionMetadata;if(a.actionType&&I&&N&&!g.O(N,vpb)){var Q=g.O(D.actionMetadata,Y7);Q&&(Q.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",D.actionMetadata={mainVideoEntityActionMetadata:Q});d.push(D)}}}catch(P){return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.PB&&"QUOTA_EXCEEDED"===P.type&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,d,x)}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,d)},xpb=function(){V7.apply(this,arguments);
this.V="mainVideoEntity"},ypb=async function(a,b,c){b=void 0===b?43200:b;
c=void 0===c?!0:c;var d=void 0===d?!1:d;if(!a.J.ji())return[];var e=[];try{e=await Wob(b,c,d)}catch(f){f instanceof Error&&"No data"===f.message||f instanceof Error&&"Empty response body"===f.message&&l7(f.message)}return Rob(a,e,c)},zpb=async function(a,b,c){c=void 0===c?!1:c;
var d=[];if(!await Xob()&&!c)return[];c=await k7();var e=await rnb(c);e.reverse();c=[];e=g.u(e);for(var f=e.next();!f.done;f=e.next())(f=f.value)&&c.push(g.KN(f).entityId);b=await Zob(b);if(null==b||!b.length)return[];c.length&&(c=await W7(a,c,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"),d=d.concat(c));b=g.u(b);for(c=b.next();!c.done;c=b.next())f=c.value,c=f.actionType,e=f.entityKey,f=f.actionMetadata,c&&e&&f&&!g.O(f,vpb)&&(e=g.KN(e).entityId,c=await W7(a,[e],"mainVideoEntity",c,
f),d=d.concat(c));return d},Apb=async function(){var a=await k7();
if(a){var b=await j7(a,"mainVideoEntity"),c=await j7(a,"mainPlaylistEntity"),d=g.LN("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),e=await i7(a,d,"mainDownloadsListEntity");d=new Set;var f;if(null==e?0:null==(f=e.downloads)?0:f.length)for(f=g.u(e.downloads),e=f.next();!e.done;e=f.next()){e=e.value;var h=void 0,l=null!=(h=e.videoItem)?h:e.playlistItem;l&&d.add(l)}f=new Set;e=[];c=g.u(c);for(h=c.next();!h.done;h=c.next()){h=h.value;if(h.videos){l=g.u(h.videos);for(var m=l.next();!m.done;m=
l.next())(m=JSON.parse(g.KN(m.value).entityId).videoId)&&f.add(m)}h.key&&!d.has(h.key)&&e.push(h.key)}b=g.u(b);for(c=b.next();!c.done;c=b.next())c=c.value,c.key&&!d.has(c.key)&&(h=g.KN(c.key).entityId,f.has(h)||e.push(c.key));e.length&&await tnb(a,e)}},Cpb=async function(a,b,c,d){var e=g.LN(a,"musicTrack"),f=g.LN(a,"transfer"),h=await g7(b,{mode:"readonly",
hc:!0},function(x){return g.WB.all([$6(x,e,"musicTrack"),$6(x,f,"transfer"),a7(x,"musicTrack"),a7(x,"offlineOrchestrationActionWrapperEntity")])}),l=g.u(h),m=l.next().value;
h=l.next().value;var n=l.next().value;l=l.next().value;m&&(m=await Bpb(m,n),await D7(m));var p=[],q=g.LN(a,"musicTrack");m=g.u(l);for(n=m.next();!n.done;n=m.next()){n=n.value;l=g.KN(n.key).entityId;var t=z7(n);t=g.KN(t.action.entityKey).entityId;l!==a&&t!==a||v7(c,n.actionProto)||p.push(n.key)}await g7(b,{mode:"readwrite",hc:!0},function(x){var z=p.map(function(D){return d7(x,D)});
z.push(d7(x,q,{Gs:!0}));return g.WB.all(z)});
w7(h);n7(d,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"})},Epb=async function(a,b,c,d){var e=g.LN(a,"musicPlaylist"),f=g.LN("music_downloads_library_id","musicDownloadsLibraryEntity"),h=await g7(b,{mode:"readonly",
hc:!0},function(D){return g.WB.all([$6(D,e,"musicPlaylist"),$6(D,f,"musicDownloadsLibraryEntity"),a7(D,"musicPlaylist"),a7(D,"offlineOrchestrationActionWrapperEntity")])}),l=g.u(h);
h=l.next().value;var m=l.next().value,n=l.next().value;l=l.next().value;if(h){var p=await Bpb(h,n);await D7(p)}var q=[];l=g.u(l);for(p=l.next();!p.done;p=l.next()){p=p.value;var t=g.KN(p.key).entityId,x=z7(p);t!==a&&x.rootActionId!==a||v7(c,p.actionProto)||q.push(p.key)}var z=g.LN(a,"musicPlaylist");await g7(b,{mode:"readwrite",hc:!0},function(D){var I=q.map(function(N){return d7(D,N)});
I.push(d7(D,z,{Gs:!0}));return g.WB.all(I)});
if(h&&(a=await Dpb(h,n,m),a.reverse(),a.length))for(a=g.u(a),h=a.next();!h.done;h=a.next())(h=g.KN(h.value).entityId)&&await Cpb(h,b,c,d)},Gpb=async function(a,b,c){a=await g7(a,{mode:"readwrite",
hc:!0},function(e){var f=a7(e,"transfer"),h=a7(e,"offlineOrchestrationActionWrapperEntity");return g.WB.all([f,h]).then(function(l){l=g.u(l);var m=l.next().value,n=l.next().value;l=Fpb.map(function(x){return nmb(e,x)});
n=g.u(n);for(var p=n.next();!p.done;p=n.next()){p=p.value;var q="musicTrack"===g.KN(p.actionProto.entityKey).entityType,t="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"===p.actionProto.actionType;v7(b,p.actionProto)||q&&(!q||t)||l.push(d7(e,p.key,{Gs:!0}))}return g.WB.all(l).then(function(){return m})})});
a=g.u(a);for(var d=a.next();!d.done;d=a.next())d=d.value,w7(d),d=g.KN(d.key).entityId,d=g.LN(d,"musicTrack"),n7(c,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});await gnb()},Hpb=function(a){for(var b,c=g.u(a.additionalMetadatas),d=c.next();!d.done;d=c.next())d=d.value,d.offlineMusicVideoData&&(b=d.offlineMusicVideoData);
var e,f,h,l,m;return{id:g.LN(a.videoId,"musicTrack"),videoId:a.videoId,title:a.title,thumbnailDetails:a.thumbnail,lengthMs:String(1E3*Number(a.lengthSeconds)),albumTitle:null==(e=b)?void 0:e.releaseTitle,musicVideoType:null==(f=b)?void 0:f.musicVideoType,contentRating:{explicitType:null==(h=b)?void 0:h.explicitType},artistNames:(null==(l=b)?void 0:l.byline)||(null==(m=b)?void 0:m.channelName),downloadMetadata:g.LN(a.videoId,"musicTrackDownloadMetadataEntity")}},Dpb=async function(a,b,c){var d=[],
e=new Set,f;
if(null==c?0:null==(f=c.downloadedTracks)?0:f.length)for(c=g.u(c.downloadedTracks),f=c.next();!f.done;f=c.next())e.add(f.value);if(a.tracks){c=g.u(a.tracks);for(f=c.next();!f.done;f=c.next())f=f.value,e.has(f)||d.push(f);b=g.u(b);for(e=b.next();!e.done;e=b.next())if(e=e.value,e.id!==a.id&&(e=e.tracks))for(e=g.u(e),c=e.next();!c.done;c=e.next())c=d.indexOf(c.value),-1!==c&&d.splice(c,1)}return d},Bpb=async function(a,b){var c=x7(a.thumbnailDetails);
b=g.u(b);for(var d=b.next();!d.done;d=b.next())if(d=d.value,d.id!==a.id){d=g.u(x7(d.thumbnailDetails));for(var e=d.next();!e.done;e=d.next())e=c.indexOf(e.value),-1!==e&&c.splice(e,1)}return c},Ipb=async function(a,b){var c=g.LN("music_downloads_library_id","musicDownloadsLibraryEntity"),d=await i7(a,c,"musicDownloadsLibraryEntity");
d||(d={id:c});c=g.KN(b).entityType;if("musicTrack"===c){var e;if(null==(e=d.downloadedTracks)||!e.includes(b)){var f;d.downloadedTracks=(null!=(f=d.downloadedTracks)?f:[]).concat(b)}}else if("musicPlaylist"===c){var h;if(null==(h=d.downloadedPlaylists)||!h.includes(b)){var l;d.downloadedPlaylists=(null!=(l=d.downloadedPlaylists)?l:[]).concat(b)}}await h7(a,d,"musicDownloadsLibraryEntity")},Jpb=async function(a,b){var c=g.LN("music_downloads_library_id","musicDownloadsLibraryEntity");
if(c=await i7(a,c,"musicDownloadsLibraryEntity")){var d=g.KN(b).entityType;if("musicTrack"===d)var e=c.downloadedTracks;else"musicPlaylist"===d&&(e=c.downloadedPlaylists);var f;if(null==(f=e)?0:f.length)for(f=0;f<e.length;f++)if(e[f]===b){e.splice(f,1);break}await h7(a,c,"musicDownloadsLibraryEntity")}},Kpb=function(a,b){this.j=a;
this.B=b},Npb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=[];
try{e=await Lpb(a,d);var f;(null==(f=e)?0:f.length)&&await Ipb(a.j,b.entityKey)}catch(l){return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.PB&&"QUOTA_EXCEEDED"===l.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,a)}a=[];var h;if(null==(h=e)?0:h.length)for(e=g.u(e),h=e.next();!h.done;h=
e.next())if(h=h.value.offlineVideoData,d=void 0,null==(d=h)?0:d.videoId)d=void 0,f=Number((null==(d=b.actionMetadata)?void 0:d.priority)||0)+1,a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",f,Z7,Mpb(b,h)));return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},Ppb=async function(a,b){var c=q7(b),d=b.entityKey,e=g.KN(d).entityId,f=[],h=!1;
"!*$_ALL_ENTITIES_!*$"===e?(h=!0,f=await j7(a.j,"musicPlaylist")):(d=await i7(a.j,d,"musicPlaylist"))&&f.push(d);var l;if(null==(l=f)||!l.length)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);var m;l=null==(m=g.O(b.actionMetadata,Opb))?void 0:m.autoSync;var n=[],p=!0;m=!0;var q=!1;d=void 0;if(h||!1!==l){try{n=await $ob(!!l,f)}catch(P){P instanceof Error&&"No data"===P.message?"!*$_ALL_ENTITIES_!*$"===e?await Gpb(a.j,b,a.B):await Epb(e,a.j,b,a.B):P instanceof Error&&"Empty response body"===
P.message&&l7(P.message)}if(!n.length||!h&&n[0].playlistId!==e)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)}if(h){b=[];for(var t=g.u(n),x=t.next();!x.done;x=t.next())x=x.value,x.upToDate||l&&!x.shouldAutoSyncMetadata||!x.playlistId||b.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x.playlistId,"musicPlaylist",0,Z7,{musicPlaylistEntityActionMetadata:{autoSync:l}}));return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,b)}if(n.length&&(h=n[0],q=!!h.upToDate,l)){var z;
p=null!=(z=h.shouldAutoSyncMetadata)?z:!0;var D;m=null!=(D=h.shouldAutoSyncVideos)?D:!0;h.checkInSeconds&&(d=h.checkInSeconds)}if(q||!p)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);l=[];f=f[0];z=void 0;if(f.downloadMetadata){z=await i7(a.j,f.downloadMetadata,"musicPlaylistDownloadMetadataEntity");var I;z=Number(null!=(I=null==z?void 0:z.addedTimestampMillis)?I:"0")/1E3}try{var N;l=await Lpb(a,e,null==(N=z)?void 0:N.toString(),d)}catch(P){if(P instanceof Error&&"No data"===P.message)await Epb(e,
a.j,b,a.B);else if(P instanceof Error&&"Empty response body"===P.message)l7(P.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.PB&&"QUOTA_EXCEEDED"===P.type&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,b,t)}if(!m)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c);a=[];e=new Map;var Q;if(null==(Q=l)?0:Q.length)for(Q=g.u(l),I=Q.next();!I.done;I=Q.next())I=I.value.offlineVideoData,N=void 0,(null==(N=I)?0:N.videoId)&&e.set(I.videoId,I);I=new Map;Q=[];if(null==f?0:null==(x=f.tracks)?0:x.length)for(x=g.u(f.tracks),N=x.next();!N.done;N=x.next())if(N=g.KN(N.value).entityId)e.has(N)?(I.set(N,e.get(N)),e.delete(N)):Q.push(N);x=Number((null==(t=b.actionMetadata)?void 0:t.priority)||0)+1;t=g.u(e.entries());for(e=t.next();!e.done;e=t.next())N=g.u(e.value),e=N.next().value,
N=N.next().value,a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"musicTrack",x,Z7,Mpb(b,N)));t=g.u(I.entries());for(e=t.next();!e.done;e=t.next())I=g.u(e.value),e=I.next().value,I=I.next().value,a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e,"musicTrack",x,Z7,Mpb(b,I)));b=g.u(Q);for(t=b.next();!t.done;t=b.next())a.push(J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",t.value,"musicTrack",0,Z7));return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,a)},Qpb=async function(a,b){var c=
q7(b);
try{var d=g.KN(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await Gpb(a.j,b,a.B):(await Epb(d,a.j,b,a.B),await Jpb(a.j,b.entityKey))}catch(e){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Lpb=async function(a,b,c,d){b=await Uob([b]);
a=(await Rpb(a,b[0],c,d)).musicPlaylistEntity;a=x7(a.thumbnailDetails);await E7(a);return b[0].videos},Rpb=async function(a,b,c,d){var e=b.videos,f=b.playlistId,h=[],l=[],m=[];
c=c?(1E3*Number(c)).toString():Date.now().toString();if(e){e=g.u(e);for(var n=e.next();!n.done;n=e.next()){var p=n.value.offlineVideoData.videoId;n={id:g.LN(p,"musicTrack")};p=g.LN(p,"musicTrackDownloadMetadataEntity");h.push(n);l.push(n.id);m.push(p)}}e=b.lastModifiedTimestamp?(1E3*Number(b.lastModifiedTimestamp)).toString():"0";var q={id:g.LN(f,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:m,lastModifiedTimestampMillis:e,addedTimestampMillis:c,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},
t={id:g.LN(f,"musicPlaylist"),title:b.title,playlistId:f,thumbnailDetails:b.thumbnail,visibility:Spb(b),trackCount:b.totalVideoCount,tracks:l,downloadMetadata:q.id};d&&((null==t?0:t.entityMetadata)?t.entityMetadata.nextAutoRefreshIntervalSeconds=String(d):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:String(d)}));await g7(a.j,{mode:"readwrite",hc:!0},function(x){for(var z=c7(x,t,"musicPlaylist"),D=[],I=g.u(h),N=I.next();!N.done;N=I.next())D.push(c7(x,N.value,"musicTrack"));x=c7(x,q,"musicPlaylistDownloadMetadataEntity");
return g.WB.all([z].concat(g.la(D),[x]))});
return{musicPlaylistEntity:t,ydb:h}},Spb=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Mpb=function(a,b){b={track:Hpb(b)};
if(a=g.O(a.actionMetadata,Opb))b.maximumDownloadQuality=a.maximumDownloadQuality;return{musicTrackEntityActionMetadata:b}},Tpb=function(a,b){this.j=a;
this.B=b},Xpb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=g.O(b.actionMetadata,Upb);
try{await Vpb(a,d,void 0,null==e?void 0:e.track),(null==e?0:e.playlistId)||await Ipb(a.j,b.entityKey)}catch(h){return d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.PB&&"QUOTA_EXCEEDED"===h.type&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,d,b)}var f;a=Number((null==(f=b.actionMetadata)?
void 0:f.priority)||0)+1;b=(b=g.O(b.actionMetadata,Upb))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;d=J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d,"playbackData",a,Wpb,b);return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[d])},Ypb=async function(a,b){var c=q7(b),d=g.KN(b.entityKey).entityId,e=await i7(a.j,b.entityKey,"musicTrack"),f=e?await i7(a.j,e.downloadMetadata,"musicTrackDownloadMetadataEntity"):void 0;
if(!e||!f)return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c);try{await Vpb(a,d,f.addedTimestampMillis);var h,l=Number((null==(h=b.actionMetadata)?void 0:h.priority)||0)+1;var m=J7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"playbackData",l,Wpb)}catch(n){if(n instanceof Error&&"No data"===n.message)await Cpb(d,a.j,b,a.B);else if(n instanceof Error&&"Empty response body"===n.message)l7(n.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",
n instanceof g.PB&&"QUOTA_EXCEEDED"===n.type&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,a,b)}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,m?[m]:void 0)},Zpb=async function(a,b){var c=q7(b);
try{var d=g.KN(b.entityKey).entityId;"!*$_ALL_ENTITIES_!*$"===d?await Gpb(a.j,b,a.B):(await Cpb(d,a.j,b,a.B),await Jpb(a.j,b.entityKey))}catch(e){return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED")}return new K7("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c)},Vpb=async function(a,b,c,d){d||(d=(await Tob([b]))[0],d=Hpb(d));
a=await $pb(a,d,b,c);await E7(x7(a.thumbnailDetails))},$pb=async function(a,b,c,d){d||(d=Date.now().toString());
var e={id:g.LN(c,"musicTrackDownloadMetadataEntity"),playbackData:g.LN(c,"playbackData"),addedTimestampMillis:d,videoDownloadContextEntity:g.LN(c,"videoDownloadContextEntity")};await g7(a.j,{mode:"readwrite",hc:!0},function(f){var h=c7(f,e,"musicTrackDownloadMetadataEntity");f=c7(f,b,"musicTrack");return g.WB.all([h,f])});
await u7(c,"musicTrackDownloadMetadataEntity",a.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD");return b},$7=function(){V7.apply(this,arguments);
this.V="musicTrack"},aqb=function(){g.WT.apply(this,arguments);
var a=this;this.events=new g.FK(this);this.Z=this.player.W();this.Qd={ccb:function(){return a.j},
kH:function(){return a.kH()}}},bqb=function(a){if(a.N("embeds_web_enable_video_data_refactoring_offline_and_progress_bar")){var b;
a=g.O(null==(b=a.zd)?void 0:b.currentVideoEndpoint,g.rO);if(null==a?0:a.playlistId)var c=a.playlistId;return c}return a.e3},cqb=async function(a,b){var c=b.clientPlaybackNonce,d={cpn:c,
offlineSourceVisualElement:g.dH(b.Ba||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};b.u&&(d.videoFmt=Number(b.u.itag));b.C&&(d.audioFmt=Number(b.C.itag));var e=bqb(b),f;if(f=e&&b.videoId)b=b.videoId,f=await ("PPSV"!==e?Promise.resolve(!1):a.j.TR(b));f&&(d.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");a.u=c;g.IB("offlinePlaybackStarted",d)};
g.w(V6,U6);g.da.Object.defineProperties(V6.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},
set:function(a){this.j.entityMetadata=a}}});
g.w(Dkb,V6);Dkb.prototype.u=function(){return[]};
g.w(Ekb,V6);Ekb.prototype.u=function(){var a=[];this.j.alternateChannel&&a.push(this.j.alternateChannel);this.j.alternateChannelList&&a.push.apply(a,g.la(this.j.alternateChannelList));this.j.oneofChannelEntity&&a.push(this.j.oneofChannelEntity);return[].concat(g.la(new Set(a)))};
g.w(Fkb,V6);Fkb.prototype.u=function(){var a=[];this.j.entryCollection&&a.push(this.j.entryCollection);return[].concat(g.la(new Set(a)))};
g.w(Gkb,U6);Gkb.prototype.u=function(){var a=[];this.j.video&&a.push(this.j.video);return[].concat(g.la(new Set(a)))};
g.w(Hkb,V6);Hkb.prototype.u=function(){var a=[];this.j.parentPlaylist&&a.push(this.j.parentPlaylist);if(this.j.entries)for(var b=g.u(this.j.entries),c=b.next();!c.done;c=b.next())a.push.apply(a,g.la((new Gkb(c.value)).u()));return[].concat(g.la(new Set(a)))};
g.w(Ikb,V6);Ikb.prototype.u=function(){var a=[];this.j.descriptionEntity&&a.push(this.j.descriptionEntity);this.j.creators&&a.push.apply(a,g.la(this.j.creators));this.j.theBiggestFan&&a.push(this.j.theBiggestFan);return[].concat(g.la(new Set(a)))};
g.w(Jkb,V6);Jkb.prototype.u=function(){return[]};
g.w(Kkb,V6);Kkb.prototype.u=function(){return[]};
g.w(Lkb,V6);Lkb.prototype.u=function(){return[]};
g.w(Mkb,V6);Mkb.prototype.u=function(){return[]};
g.w(Nkb,V6);Nkb.prototype.u=function(){return[]};
g.w(Okb,V6);Okb.prototype.u=function(){return[]};
g.w(Pkb,V6);Pkb.prototype.u=function(){return[]};
g.w(Qkb,V6);Qkb.prototype.u=function(){var a=[];this.j.downloadsList&&a.push(this.j.downloadsList);this.j.smartDownloadsList&&a.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&a.push(this.j.recommendedDownloadsList);return[].concat(g.la(new Set(a)))};
g.w(Rkb,U6);Rkb.prototype.u=function(){var a=[];this.j.video&&a.push(this.j.video);this.j.playlist&&a.push(this.j.playlist);this.j.videoItem&&a.push(this.j.videoItem);this.j.playlistItem&&a.push(this.j.playlistItem);return[].concat(g.la(new Set(a)))};
g.w(Skb,V6);Skb.prototype.u=function(){var a=[];this.j.refresh&&a.push(this.j.refresh);if(this.j.downloads)for(var b=g.u(this.j.downloads),c=b.next();!c.done;c=b.next())a.push.apply(a,g.la((new Rkb(c.value)).u()));return[].concat(g.la(new Set(a)))};
g.w(Tkb,V6);Tkb.prototype.u=function(){var a=[];this.j.localImageEntities&&a.push.apply(a,g.la(this.j.localImageEntities));return[].concat(g.la(new Set(a)))};
g.w(Ukb,V6);Ukb.prototype.u=function(){var a=[];this.j.playbackData&&a.push(this.j.playbackData);this.j.localImageEntities&&a.push.apply(a,g.la(this.j.localImageEntities));this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[].concat(g.la(new Set(a)))};
g.w(Vkb,V6);Vkb.prototype.u=function(){return[]};
g.w(Wkb,V6);Wkb.prototype.u=function(){var a=[];this.j.fakeChildren&&a.push.apply(a,g.la(this.j.fakeChildren));return[].concat(g.la(new Set(a)))};
g.w(Xkb,V6);Xkb.prototype.u=function(){var a=[];this.j.video&&a.push(this.j.video);this.j.playbackData&&a.push(this.j.playbackData);this.j.offlineVideoPolicy&&a.push(this.j.offlineVideoPolicy);return[].concat(g.la(new Set(a)))};
g.w(Ykb,V6);Ykb.prototype.u=function(){return[]};
g.w(Zkb,V6);Zkb.prototype.u=function(){var a=[];this.j.channelOwner&&a.push(this.j.channelOwner);this.j.videos&&a.push.apply(a,g.la(this.j.videos));this.j.collaboratorChannels&&a.push.apply(a,g.la(this.j.collaboratorChannels));this.j.downloadState&&a.push(this.j.downloadState);this.j.refresh&&a.push(this.j.refresh);return[].concat(g.la(new Set(a)))};
g.w($kb,V6);$kb.prototype.u=function(){var a=[];this.j.video&&a.push(this.j.video);this.j.channelContributor&&a.push(this.j.channelContributor);return[].concat(g.la(new Set(a)))};
g.w(alb,U6);alb.prototype.u=function(){var a=[];this.j.localImageEntities&&a.push.apply(a,g.la(this.j.localImageEntities));this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[].concat(g.la(new Set(a)))};
g.w(blb,U6);blb.prototype.u=function(){var a=[];this.j.recommendedVideoMetadata&&a.push.apply(a,g.la((new alb(this.j.recommendedVideoMetadata)).u()));return[].concat(g.la(new Set(a)))};
g.w(clb,U6);clb.prototype.u=function(){var a=[];this.j.playbackPosition&&a.push(this.j.playbackPosition);return[].concat(g.la(new Set(a)))};
g.w(dlb,V6);dlb.prototype.u=function(){var a=[];this.j.owner&&a.push(this.j.owner);this.j.downloadState&&a.push(this.j.downloadState);this.j.userState&&a.push.apply(a,g.la((new clb(this.j.userState)).u()));this.j.additionalMetadata&&a.push.apply(a,g.la((new blb(this.j.additionalMetadata)).u()));return[].concat(g.la(new Set(a)))};
g.w(elb,V6);elb.prototype.u=function(){var a=[];this.j.userChannelDetails&&a.push(this.j.userChannelDetails);return[].concat(g.la(new Set(a)))};
g.w(flb,V6);flb.prototype.u=function(){var a=[];this.j.channelOwner&&a.push(this.j.channelOwner);this.j.playbackPosition&&a.push(this.j.playbackPosition);this.j.localImageEntities&&a.push.apply(a,g.la(this.j.localImageEntities));this.j.downloadStatus&&a.push(this.j.downloadStatus);return[].concat(g.la(new Set(a)))};
g.w(glb,V6);glb.prototype.u=function(){return[]};
g.w(hlb,V6);hlb.prototype.u=function(){return[]};
g.w(ilb,V6);ilb.prototype.u=function(){return[]};
g.w(jlb,V6);jlb.prototype.u=function(){return[]};
g.w(klb,V6);klb.prototype.u=function(){return[]};
g.w(llb,V6);llb.prototype.u=function(){return[]};
g.w(mlb,V6);mlb.prototype.u=function(){var a=[];this.j.trackDownloadMetadatas&&a.push.apply(a,g.la(this.j.trackDownloadMetadatas));return[].concat(g.la(new Set(a)))};
g.w(nlb,V6);
nlb.prototype.u=function(){var a=[];this.j.downloadedTracks&&a.push.apply(a,g.la(this.j.downloadedTracks));this.j.smartDownloadedTracks&&a.push.apply(a,g.la(this.j.smartDownloadedTracks));this.j.downloadedEpisodes&&a.push.apply(a,g.la(this.j.downloadedEpisodes));this.j.downloadedAlbumReleases&&a.push.apply(a,g.la(this.j.downloadedAlbumReleases));this.j.smartDownloadedAlbumReleases&&a.push.apply(a,g.la(this.j.smartDownloadedAlbumReleases));this.j.downloadedPlaylists&&a.push.apply(a,g.la(this.j.downloadedPlaylists));this.j.smartDownloadedPlaylists&&
a.push.apply(a,g.la(this.j.smartDownloadedPlaylists));return[].concat(g.la(new Set(a)))};
g.w(olb,V6);olb.prototype.u=function(){var a=[];this.j.trackDownloadMetadatas&&a.push.apply(a,g.la(this.j.trackDownloadMetadatas));return[].concat(g.la(new Set(a)))};
g.w(plb,V6);plb.prototype.u=function(){var a=[];this.j.playbackData&&a.push(this.j.playbackData);this.j.localImageEntities&&a.push.apply(a,g.la(this.j.localImageEntities));this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[].concat(g.la(new Set(a)))};
g.w(qlb,V6);qlb.prototype.u=function(){var a=[];this.j.musicLibraryStatusEntity&&a.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&a.push.apply(a,g.la(this.j.primaryArtists));this.j.details&&a.push(this.j.details);this.j.userDetails&&a.push(this.j.userDetails);this.j.tracks&&a.push.apply(a,g.la(this.j.tracks));this.j.share&&a.push(this.j.share);this.j.downloadMetadata&&a.push(this.j.downloadMetadata);this.j.refresh&&a.push(this.j.refresh);return[].concat(g.la(new Set(a)))};
g.w(rlb,V6);rlb.prototype.u=function(){var a=[];this.j.albumRelease&&a.push(this.j.albumRelease);this.j.tracks&&a.push.apply(a,g.la(this.j.tracks));return[].concat(g.la(new Set(a)))};
g.w(slb,V6);slb.prototype.u=function(){var a=[];this.j.albumRelease&&a.push(this.j.albumRelease);return[].concat(g.la(new Set(a)))};
g.w(tlb,V6);tlb.prototype.u=function(){var a=[];this.j.details&&a.push(this.j.details);this.j.userDetails&&a.push(this.j.userDetails);return[].concat(g.la(new Set(a)))};
g.w(ulb,V6);ulb.prototype.u=function(){var a=[];this.j.parentArtist&&a.push(this.j.parentArtist);return[].concat(g.la(new Set(a)))};
g.w(vlb,V6);vlb.prototype.u=function(){var a=[];this.j.parentArtist&&a.push(this.j.parentArtist);return[].concat(g.la(new Set(a)))};
g.w(wlb,V6);wlb.prototype.u=function(){return[]};
g.w(xlb,V6);xlb.prototype.u=function(){return[]};
g.w(ylb,U6);ylb.prototype.u=function(){var a=[];this.j.creatorEntity&&a.push(this.j.creatorEntity);return[].concat(g.la(new Set(a)))};
g.w(zlb,V6);
zlb.prototype.u=function(){var a=[];this.j.tracks&&a.push.apply(a,g.la(this.j.tracks));this.j.refresh&&a.push(this.j.refresh);this.j.musicLibraryStatusEntity&&a.push(this.j.musicLibraryStatusEntity);this.j.details&&a.push(this.j.details);this.j.downloadMetadata&&a.push(this.j.downloadMetadata);this.j.sideloadMetadata&&a.push(this.j.sideloadMetadata);this.j.userDetails&&a.push(this.j.userDetails);this.j.entryCollection&&a.push(this.j.entryCollection);this.j.share&&a.push(this.j.share);this.j.podcastShowAdditionalMetadata&&
a.push.apply(a,g.la((new ylb(this.j.podcastShowAdditionalMetadata)).u()));return[].concat(g.la(new Set(a)))};
g.w(Alb,V6);Alb.prototype.u=function(){return[]};
g.w(Blb,V6);
Blb.prototype.u=function(){var a=[];this.j.musicLibraryStatusEntity&&a.push(this.j.musicLibraryStatusEntity);this.j.artists&&a.push.apply(a,g.la(this.j.artists));this.j.audioModeVersion&&a.push(this.j.audioModeVersion);this.j.videoModeVersion&&a.push(this.j.videoModeVersion);this.j.userDetails&&a.push(this.j.userDetails);this.j.details&&a.push(this.j.details);this.j.albumRelease&&a.push(this.j.albumRelease);this.j.share&&a.push(this.j.share);this.j.libraryEdit&&a.push(this.j.libraryEdit);this.j.downloadMetadata&&
a.push(this.j.downloadMetadata);this.j.playbackPosition&&a.push(this.j.playbackPosition);return[].concat(g.la(new Set(a)))};
g.w(Clb,V6);Clb.prototype.u=function(){var a=[];this.j.parentTrack&&a.push(this.j.parentTrack);return[].concat(g.la(new Set(a)))};
g.w(Dlb,V6);Dlb.prototype.u=function(){var a=[];this.j.parentTrack&&a.push(this.j.parentTrack);return[].concat(g.la(new Set(a)))};
g.w(Elb,V6);Elb.prototype.u=function(){return[]};
g.w(Flb,V6);Flb.prototype.u=function(){return[]};
g.w(Glb,V6);Glb.prototype.u=function(){return[]};
g.w(Hlb,V6);Hlb.prototype.u=function(){return[]};
g.w(Ilb,V6);Ilb.prototype.u=function(){var a=[];this.j.transfer&&a.push(this.j.transfer);this.j.adsPlaybackData&&a.push.apply(a,g.la(this.j.adsPlaybackData));this.j.drmLicense&&a.push(this.j.drmLicense);this.j.offlineVideoPolicy&&a.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&a.push(this.j.videoDownloadContextEntity);return[].concat(g.la(new Set(a)))};
g.w(Jlb,V6);Jlb.prototype.u=function(){return[]};
g.w(Klb,V6);Klb.prototype.u=function(){var a=[];this.j.offlineVideoStreams&&a.push.apply(a,g.la(this.j.offlineVideoStreams));this.j.captionTrack&&a.push.apply(a,g.la(this.j.captionTrack));return[].concat(g.la(new Set(a)))};
g.w(Llb,V6);Llb.prototype.u=function(){return[]};
g.w(Mlb,V6);Mlb.prototype.u=function(){return[]};
g.w(Nlb,V6);Nlb.prototype.u=function(){return[]};
g.w(Olb,V6);Olb.prototype.u=function(){return[]};
g.w(Plb,V6);Plb.prototype.u=function(){return[]};
g.w(Qlb,V6);Qlb.prototype.u=function(){return[]};
g.w(Rlb,V6);Rlb.prototype.u=function(){return[]};
g.w(Slb,V6);Slb.prototype.u=function(){return[]};
g.w(Tlb,V6);Tlb.prototype.u=function(){return[]};
var apb=["browse","music/browse","unplugged/browse"],bpb=["offline/playlist_sync_check"],Sob=["offline"],Dnb=["offline/get_playback_data_entity"];W6.getInstance=async function(){return new Promise(function(a){g.FC().then(function(b){b?(W6.instance||(W6.instance=new W6(b)),a(W6.instance)):a(void 0)})})};
W6.prototype.get=async function(a){if(a=await (await Ulb(this.token)).get("prefs",a)){var b=(0,g.aC)();if(!(a.expirationTimestampMs<=b))return a.value}};
W6.prototype.set=async function(a,b,c){c=void 0===c?31536E3:c;var d=(0,g.aC)();a={key:a,value:b,expirationTimestampMs:d+1E3*c};await g.gC(await Ulb(this.token),"prefs",a)};
W6.prototype.remove=async function(a){await (await Ulb(this.token)).delete("prefs",a)};
var X6;g.w(Y6,g.sB);g.w(Z6,bmb);Z6.prototype.B=function(a,b){b=dmb(b);a=(new TextEncoder).encode(JSON.stringify(a));return this.j.encrypt(a,b)};
Z6.prototype.u=function(a,b){if(!(a instanceof Uint8Array))throw Ylb(1);var c=new TextDecoder;b=dmb(b);a=this.j.decrypt(a,b);return JSON.parse(c.decode(a))};
var emb={buttonEntity:Olb,captionTrack:Elb,channelHandle:Dkb,commerceAcquisitionClientPayloadEntity:Qlb,commerceCartListEntity:Rlb,continuationTokenEntity:Ykb,downloadQualityPickerEntity:Nkb,downloadsPageRefreshTokenEntity:Pkb,downloadsPageViewConfigurationEntity:glb,downloadStatusEntity:Okb,emojiFountainDataEntity:Nlb,fakeChannel:Ekb,fakePlaylist:Fkb,fakePlaylistEntryCollection:Hkb,fakeVideo:Ikb,fakeVideoDescription:Jkb,featuredProductsEntity:klb,flowStateEntity:Kkb,iconBadgeEntity:Slb,liveChatPollStateEntity:Mkb,
logoEntity:Lkb,macroMarkerEntity:hlb,mainDownloadsLibraryEntity:Qkb,mainDownloadsListEntity:Skb,mainPlaylistDownloadStateEntity:Tkb,mainPlaylistEntity:Zkb,mainPlaylistVideoEntity:$kb,mainVideoDownloadStateEntity:Ukb,mainVideoEntity:dlb,markersVisibilityOverrideEntity:ilb,musicAlbumReleaseDetail:rlb,musicAlbumReleaseDownloadMetadataEntity:mlb,musicAlbumRelease:qlb,musicAlbumReleaseUserDetail:slb,musicArtistDetail:ulb,musicArtist:tlb,musicArtistUserDetail:vlb,musicDownloadsLibraryEntity:nlb,musicLibraryEdit:wlb,
musicLibraryStatusEntity:xlb,musicPlaylist:zlb,musicPlaylistDownloadMetadataEntity:olb,musicShare:Alb,musicTrackDetail:Clb,musicTrackDownloadMetadataEntity:plb,musicTrack:Blb,musicTrackUserDetail:Dlb,offlineOrchestrationActionWrapperEntity:Flb,offlineVideoPolicy:Glb,offlineVideoStreams:Hlb,offlineabilityEntity:Vkb,orchestrationWebSamplingEntity:Wkb,pinnedProductEntity:llb,playbackData:Ilb,playerStateEntity:jlb,quantityIncrementerEntity:Tlb,refresh:Jlb,settingEntity:Mlb,transfer:Klb,videoDownloadContextEntity:Llb,
videoPlaybackPositionEntity:Plb,ytMainChannelEntity:elb,ytMainDownloadedVideoEntity:Xkb,ytMainVideoEntity:flb};g.w(e7,bmb);e7.prototype.B=function(a){return a};
e7.prototype.u=function(a){if(a instanceof Uint8Array)throw Ylb(0);return a};
g.w(f7,g.y);f7.prototype.u=function(a){smb(this,a.data)};
f7.prototype.xa=function(){this.channel.close()};
var xmb;var onb=new g.ts("elementsCommand");var G7=new g.ts("entityBatchUpdate");var Ymb=new g.ts("downloadStatusEntity");var gpb=new g.ts("mainPlaylistEntityActionMetadata");var Y7=new g.ts("mainVideoEntityActionMetadata");var Opb=new g.ts("musicPlaylistEntityActionMetadata");var Upb=new g.ts("musicTrackEntityActionMetadata");var pnb=new g.ts("offlineOrchestrationActionCommand");var vpb=new g.ts("localImageEntityActionMetadata");var xnb=new g.ts("playbackDataActionMetadata");var Jnb=new g.ts("transferEntityActionMetadata");g.LN("","downloadsPageViewConfigurationEntity");g.LN("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");var H7=g.LN("DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS","mainDownloadsListEntity");g.LN("SMART_DOWNLOADS_ENABLED","settingEntity");g.LN("SMART_DOWNLOADS_OPT_IN_BANNER_DISMISSED","settingEntity");g.w(m7,g.y);m7.prototype.B=function(a){this.api.Pa("onOfflineOperationFailure",a.data)};
m7.prototype.C=function(a){this.api.ra("offlinetransferpause",a.data)};
m7.prototype.xa=function(){var a;null==(a=this.j)||a.close();var b;null==(b=this.u)||b.close()};Omb.prototype.request=function(a,b,c){b=void 0===b?{}:b;return this.locks.request(a,b,function(d){return c(d)})};Qmb.prototype.Pg=function(){this.j&&o7(this)};
Qmb.prototype.XI=function(){this.u&&this.u.resolve();this.B=this.j=!1;this.ma()};var dob=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var C7=g.va.caches,cnb,enb;B7.prototype.open=function(a){return C7.open(bnb(a))};
B7.prototype.has=function(a){return C7.has(bnb(a))};
B7.prototype.delete=function(a){return C7.delete(bnb(a))};
B7.prototype.match=async function(a,b){var c=await this.keys();c=g.u(c);for(var d=c.next();!d.done;d=c.next())if(d=await (await this.open(d.value)).match(a,b))return d};
g.w(anb,B7);anb.prototype.keys=async function(){var a=[],b=g.tB("CacheStorage keys"),c=await C7.keys();c=g.u(c);for(var d=c.next();!d.done;d=c.next()){d=d.value;var e=d.indexOf(":");d=-1===e?{xI:d}:{xI:d.substring(0,e),datasyncId:d.substring(e+1)};e=d.xI;d.datasyncId===b&&a.push(e)}return a};var lnb="captionTrack ytMainDownloadedVideoEntity ytMainVideoEntity downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.w(wnb,I7);wnb.prototype.u=function(a){return r7(a)?Bnb(this,a):s7(a)?Cnb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.w(Enb,I7);Enb.prototype.u=function(a){return r7(a)?Gnb(this,a):s7(a)?Hnb(this,a):"OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"===a.actionType&&a.entityKey?Inb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};var Lnb;Tnb.prototype.j=function(a,b){var c=a.action.actionMetadata.priority-b.action.actionMetadata.priority;0===c&&(a.j<b.j?c=-1:a.j>b.j&&(c=1));return c};g.w(M7,g.y);M7.prototype.xa=function(){this.ma&&this.ma();g.y.prototype.xa.call(this)};
M7.prototype.createAction=function(a,b){var c=g.KN(a.entityKey).entityType,d=g.oG(16);return new y7(c,d,a,b.actionId,b.rootActionId)};
M7.prototype.qa=async function(a){if(!this.isDisposed()){var b;a=null!=(b=a.offlineOrchestrationActionWrapperEntity)?b:new Set;b=[];a=g.u(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var d=g.KN(c).entityId;Vnb(this.j,d)||b.push(c)}b=await gob(this,b);await fob(this,b)}};
M7.prototype.retry=async function(){await hob(this)};g.k=nob.prototype;g.k.q7=async function(a){if(g.U(a.state,128)){a=a.state.fh;var b=null==a?void 0:a.errorCode;a="net.connect"===b&&1===(null==a?void 0:a.CG)?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(null==b?0:b.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";await this.xw(this.player.getVideoData().videoId,a)}};
g.k.xw=async function(a,b){this.u||(this.u=!0,"TRANSFER_FAILURE_REASON_NETWORK_LOST"===b?O7(this,a,!1,!0):(await N7(this,a),g.VN(a,4),await this.j.xw(b)))};
g.k.mI=function(a){2===a.status?(a.status!==this.B&&(Eob(this.j),g.VN(a.videoId,2)),a.lE&&Job(this.j,a.videoId,a.lE)):4===a.status?(N7(this,a.videoId),this.xw(a.videoId,a.pH?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):1===a.status&&Iob(this.j);this.B=a.status;this.api.Pa("localmediachange",{videoId:a.videoId,status:a.status})};
g.k.YO=async function(){if(!this.u){this.u=!0;var a=this.player.getVideoData().videoId;await N7(this,a);await this.j.YO()}};
g.k.QM=function(a){switch(a){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.k.N=function(a){return this.api.W().N(a)};g.w(P7,g.y);P7.prototype.xa=function(){this.u&&this.u();g.y.prototype.xa.call(this)};
P7.prototype.B=async function(a){var b;a=null!=(b=a.transfer)?b:new Set;b=[];a=g.u(a);for(var c=a.next();!c.done;c=a.next())c=g.KN(c.value).entityId,b.push(c);0!==b.length&&await tob(this,b)};g.w(xob,g.y);g.k=xob.prototype;g.k.xa=function(){this.oa&&this.oa();this.qa.dispose();this.C.dispose();this.Fa&&g.ad(this.J.Yl,this.Fa);this.Ga&&g.ad(this.J.Yl,this.Ga);g.y.prototype.xa.call(this)};
g.k.s9=async function(a){var b=g.LN(a,"transfer");if(this.j&&b===this.j.key)O7(this.K,this.D,!0),this.C.stop();else{var c=await g7(this.u,{mode:"readwrite",hc:!0},function(e){return $6(e,b,"transfer").then(function(f){if(f&&"TRANSFER_STATE_COMPLETE"!==f.transferState&&"TRANSFER_STATE_FAILED"!==f.transferState)return f.transferState="TRANSFER_STATE_PAUSED_BY_USER",c7(e,f,"transfer").then(function(){return f})})});
if(c){a&&this.B&&await u7(a,this.B,this.u,"DOWNLOAD_STATE_PAUSED");var d=await S7(this,a);Wmb({videoId:a,zl:c,offlineModeType:d})}}};
g.k.r9=function(){var a=this;if(this.j&&this.D){O7(this.K,this.D,!1);var b=this.j,c=(null==b?0:b.key)?g.KN(b.key).entityId:"";c&&this.B&&(new Promise(function(d,e){u7(c,a.B,a.u,"DOWNLOAD_STATE_PAUSED").catch(function(f){e(f)})})).catch(function(d){l7("Download state setting error",d)})}this.C.stop()};
g.k.DE=function(){this.j?Aob(this,this.j):R7(this)};
g.k.K0=async function(a){if(this.j&&("TRANSFER_STATE_COMPLETE"!==this.j.transferState&&"TRANSFER_STATE_FAILED"!==this.j.transferState&&a.transfer&&a.transfer.has(this.j.key)&&((this.j=await i7(this.u,this.j.key,"transfer"))||await Bob(this)),this.j))return;await R7(this)};
g.k.xw=async function(a,b){if(this.j){var c=this.j,d=(null==c?0:c.key)?g.KN(c.key).entityId:"";a:switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var e=!1;break a;default:e=!0}e&&Kob(this)?(await T7(this,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),a=await S7(this,d),p7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:d,zl:c,offlineModeType:a}),
d&&this.B&&await u7(d,this.B,this.u,"DOWNLOAD_STATE_RETRYABLE_FAILURE")):(await Lob(this,a),d&&this.B&&await u7(d,this.B,this.u,"DOWNLOAD_STATE_FAILED"))}else U7(this,"onTransferFailure: "+a);Q7(this);c=R7(this,!0);b&&b(c)};
g.k.YO=async function(a){if(this.j)if(Kob(this)){await T7(this,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH");this.j||U7(this,"onMaybeTransferStreamsExpiredRetryAttempting");var b=this.j,c=(null==b?0:b.key)?g.KN(b.key).entityId:"",d=await S7(this,c);p7({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:c,zl:b,offlineModeType:d});b=$mb();g.LP(b,xnb,{isEnqueuedForExpiredStreamUrlRefetch:!0});d=g.LN(c,"playbackData");c=A7(new y7("playbackData",c,{actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",
entityKey:d,actionMetadata:b}));await h7(this.u,c,"offlineOrchestrationActionWrapperEntity")}else await Lob(this,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),this.B&&(c=this.j,(c=(null==c?0:c.key)?g.KN(c.key).entityId:"")&&await u7(c,this.B,this.u,"DOWNLOAD_STATE_FAILED"));else U7(this,"onMaybeTransferStreamsExpired");Q7(this);c=R7(this,!0);a&&a(c)};
var dqb={},Mob=(dqb.TRANSFER_STATE_TRANSFERRING=1,dqb.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,dqb);g.k=V7.prototype;g.k.QN=function(){return this.C.promise};
g.k.HQ=function(){if(this.u&&this.D)return this.C.promise;Pob(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.k.BC=function(a){var b={};return b.playbackData=new wnb(a,this.Z,this.j),b.transfer=new Enb(a,this.Z),b};
g.k.GE=async function(){this.u&&await yob(this.u)};
g.k.LQ=async function(){if(this.u||this.D){await this.QN();void 0!==this.K&&(g.Tz(this.K),this.K=void 0);var a;null==(a=this.u)||a.dispose();this.u=void 0;var b;null==(b=this.D)||b.dispose();this.D=void 0;this.api.Pa("onOrchestrationLostLeader");this.C=new g.Lk}};
g.k.isOrchestrationLeader=function(){return this.B.j};
g.k.TR=async function(){return!1};
g.k.yP=function(a){var b=this.j;b.api.ra("offlinetransferpause",a);var c;null==(c=b.u)||c.postMessage(a)};
g.k.DE=async function(a){var b=this,c=await k7();if(c){var d=g.LN(a,"transfer");await g7(c,{mode:"readwrite",hc:!0},function(e){var f=$6(e,d,"transfer"),h=void 0;b.Z.N("html5_oduc_transfer_logging")&&(h=$6(e,g.LN(a,"videoDownloadContextEntity"),"videoDownloadContextEntity"));return g.WB.all([f,h]).then(function(l){l=g.u(l);var m=l.next().value,n=l.next().value;return m&&"TRANSFER_STATE_PAUSED_BY_USER"===m.transferState?(m.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",c7(e,m,"transfer").then(function(){p7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:a,zl:m,offlineModeType:null==n?void 0:n.offlineModeType});return g.WB.resolve(null)})):g.WB.resolve(null)})})}};
g.k.VP=async function(a){a=void 0===a?43200:a;if(!this.J.ji())return Qob();var b=await k7();if(!b)return[];var c=Date.now()/1E3,d=await j7(b,"offlineVideoPolicy");b=[];d=g.u(d);for(var e=d.next();!e.done;e=d.next())e=e.value,Number(e.lastUpdatedTimestampSeconds)+a<=c&&(e=g.KN(e.key).entityId,b.push(e));return b.length?W7(this,b,this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"):[]};
g.k.refreshAllStaleEntities=async function(a){return await this.VP(a)};
g.k.UL=async function(){return[]};g.w(cpb,I7);cpb.prototype.u=function(a){return r7(a)?fpb(this,a):s7(a)?hpb(this,a):t7(a)?ipb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var X7=[10];g.w(npb,I7);npb.prototype.u=function(a){return r7(a)?qpb(this,a):s7(a)?rpb(this,a):t7(a)?spb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var ppb=[10];g.w(upb,I7);upb.prototype.u=function(a){return s7(a)?wpb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.w(xpb,V7);g.k=xpb.prototype;g.k.BC=function(a){var b=V7.prototype.BC.call(this,a);b.mainVideoEntity=new npb(a,this.Z,this.j);b.mainPlaylistEntity=new cpb(a,this.Z,this.j);b.mainDownloadsListEntity=new upb(a,this.Z,this.j);return b};
g.k.refreshAllStaleEntities=async function(a,b){var c=[];this.Z.N("web_player_offline_playlist_auto_refresh")&&(c=await ypb(this,a,b));var d,e=await (null==(d=await W6.getInstance())?void 0:d.get("sdois"));e&&(c=c.concat(await zpb(this,e,0===a)));return c=c.concat(await V7.prototype.refreshAllStaleEntities.call(this,a,b))};
g.k.GE=async function(){await V7.prototype.GE.call(this);this.Z.N("woffle_enable_main_downloads_library")&&await Apb()};
g.k.TR=async function(a){var b=await k7();if(!b)return!1;b=await i7(b,H7,"mainDownloadsListEntity");var c;if(null==b?0:null==(c=b.downloads)?0:c.length)for(a=g.LN(a,"mainVideoEntity"),b=g.u(b.downloads),c=b.next();!c.done;c=b.next())if(c.value.videoItem===a)return!0;return!1};
g.k.UL=async function(){var a=await k7();if(!a)return[];var b=await j7(a,"downloadStatusEntity");a=[];b=g.u(b);for(var c=b.next();!c.done;c=b.next())c=c.value,"DOWNLOAD_STATE_USER_DELETED"===c.downloadState&&c.key&&(c=g.KN(c.key).entityId,a.push(c));return a.length?W7(this,a,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"):[]};var Fpb="downloadStatusEntity musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.w(Kpb,I7);Kpb.prototype.u=function(a){return r7(a)?Npb(this,a):s7(a)?Ppb(this,a):t7(a)?Qpb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var Z7=[10];g.w(Tpb,I7);Tpb.prototype.u=function(a){return r7(a)?Xpb(this,a):s7(a)?Ypb(this,a):t7(a)?Zpb(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var Wpb=[10];g.w($7,V7);$7.prototype.BC=function(a){var b=V7.prototype.BC.call(this,a);b.musicTrack=new Tpb(a,this.j);b.musicPlaylist=new Kpb(a,this.j);return b};
$7.prototype.refreshAllStaleEntities=async function(a,b){var c=[];return c=c.concat(await V7.prototype.refreshAllStaleEntities.call(this,a,b))};g.w(aqb,g.WT);g.k=aqb.prototype;g.k.create=function(){var a=this;g.E(this,this.events);g.RM(this.Z)?this.j=new xpb(this.Z,this.player):g.FM(this.Z)&&(this.j=new $7(this.Z,this.player));this.events.T(this.player,"onPlaybackStartExternal",function(){a.kH()});
this.events.T(this.player,"videodatachange",function(){a.kH()})};
g.k.ul=function(){return!1};
g.k.I9=async function(a,b,c,d){return this.j?W7(this.j,a,b,c,d):Promise.reject()};
g.k.VP=function(a){return this.j.VP(a)};
g.k.refreshAllStaleEntities=function(a){return this.j.refreshAllStaleEntities(a)};
g.k.yP=function(a){this.j.yP(a)};
g.k.DE=function(a){return this.j.DE(a)};
g.k.kH=async function(){var a=this.player.getVideoData();g.UO(a)&&bqb(a)&&this.u!==a.clientPlaybackNonce&&await cqb(this,a)};
g.k.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()};
g.k.updateDownloadState=async function(a,b){var c=await k7();c?(a=g.KN(a),await u7(a.entityId,a.entityType,c,b,!0)):l7("PES is undefined")};g.VT("offline",aqb);})(_yt_player);
